!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){function e(){var t=document.querySelectorAll("script[src]"),e=t[t.length-1].src,a=e.split("/"),i=a[a.length-1];return e.replace(i,"")}var a={height:"100%",width:"99%",toolbar:["upload","mupload","test","clean","anchor","preview","picture"],tpl:{toolbar:"<div class='cb-toolbar'></div>",toolbar_button:"<div class='btn-wrap'><button class='btn primary {clsname}'>{name}</button></div>",body:"<div class='cb-body'></div>",body_item:"<div class='cb-item'><div class='cb-content'></div></div>",body_item_tool:"<div class='cb-tools'><div class='btn-wrap'></div></div>"}},i=".cb-toolbar",n=".cb-body",o=".cb-content",d=".cb-item",r="originhtml",c="cbuilder",s=e(),l={loadFile:function(e){for(var a=0;a<e.length;a++){var i=e[a];if(i.indexOf("css")>=0){var n=t("<link rel='stylesheet' type='text/css' href='"+i+"'>");t("head").append(n)}else t.ajax({async:!1,url:i})}},setObjVariable:function(e,a,i){if(void 0!=a&&"string"==typeof a){a=a.split(",");for(var n=0;n<a.length;n++){var o=a[n];i&&(o=o.replace(i,""));var d="#";a[n].indexOf(".")>=0&&(o=o.replace(/\./gi,""),d=""),e["$"+o]=t(d+a[n])}}},clean:function(){"undefined"!=typeof jcrop_api&&(jcrop_api.destroy(),jcrop_api.release(),delete jcrop_api),t.cbuilder.propertiesWindow.$selectedobj.hasClass("imgpos-active")&&t.cbuilder.propertiesWindow.$selectedobj.remove(),t.cbuilder.active.$element.find("img").css("visibility",""),t("#tempimgpos").removeAttr("id")},objectCallFunction:function(t){for(var e,a=1;a<arguments.length;a++)e=t[arguments[a]],"function"==typeof e&&e()},regex:{url:/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/},layer:{msg:function(t){layer.msg(t,{time:2e3,offset:"200px"})}}},p=function(e,i){this.options=t.extend({},a,i),this.$element=t(e),this.strucView()};t.cbuilder={append:function(e){t.cbuilder.active.$element.find(n).append(e),t.cbuilder.active._trigger("cbuilder:onWrapContent"),t.cbuilder.active._trigger("cbuilder:onContentReady")},item:{tools:{addbtn:function(e){var a="<a href='javascript:;'>"+e.text+"</a>",i=this.element.parents(d).find(".btn-wrap");i.append(a),e.click&&i.find("a:last").on("click",function(){e.click(t(this))})}}},getContent:function(){t.cbuilder.active._trigger("cbuilder:onGetContentBefore");var e="";return e=t.cbuilder.active._content?'<div class="'+c+'">'+t.cbuilder.active._content+"</div>":this._getItemsObject().html()},_getItemsObject:function(){var e=t.cbuilder.active.$element.clone(),a=e.find(".cb-body");return a}},p.prototype={strucView:function(){var e=this,a=e.options;e.$element.data("cbuilder",e);var o={init:function(){var t=e.$element;t.data(r,t.html()),t.html(""),t.addClass("cb-container").wrap(a.tpl.container).append(a.tpl.toolbar+a.tpl.body),t.width(a.width).height(a.height),o.$body=t.find(n)},loadVendors:function(){var t=["../../vendor/layer/layer.js","../../vendor/layer/skin/layer.css","../../vendor/dragula.js/dist/dragula.min.js","../../vendor/dragula.js/dist/dragula.min.css","../../vendor/jQuery-contextMenu/src/jquery.contextMenu.js","../../vendor/jQuery-contextMenu/src/jquery.contextMenu.css"];l.loadFile(t)},loadToolbar:function(){for(var a=e.options.toolbar.length,n=0;a>n;n++){var o=e.options.toolbar[n],d="src/js/toolbar/"+o+"/main.js";t.ajax({async:!1,type:"get",url:d,success:function(){var a=init(e.$element,s,l);if(a.isToolbar===!1)return a.onLoaded(),!1;var n="cb-"+a.toolbar.name;if(a.toolbar.text){e.$element.find(i).append(e.options.tpl.toolbar_button.replace(/\{name\}/,a.toolbar.text).replace(/\{clsname\}/,n)),e._trigger("",a.onLoaded);var o=e.$element.find("."+n);o.on("click",function(){if(t.cbuilder.active=e,"iframe"===a.type){var i=void 0!==a.width?a.width+"px":"95%",n=void 0!==a.height?a.height+"px":"95%";layer.open({type:2,title:a.toolbar.text,shadeClose:!0,shade:.3,area:[i,n],content:s+"toolbar/"+a.toolbar.name+"/main.html"})}e._trigger("",a.toolbar.onClick)})}else"function"==typeof a.onLoaded&&a.onLoaded()}})}},appendHtml:function(){o.$body.html(e.$element.data(r)),e.$element.data(r,"")},triggerCustomEvent:function(){t(document).ready(function(){e._trigger("cbuilder:onWrapContent"),e._trigger("cbuilder:onContentReady")})},bindEvents:function(){var a=e.$element.find(n);e.$element.on("cbuilder:onWrapContent",function(i){a.children(":not("+d+")").each(function(){var a=t(this);a.wrap(e.options.tpl.body_item),t.cbuilder.active=e})}),dragula(a[0],{moves:function(t,e,a){return"item-move"===a.className}}),e.$element.on("cbuilder:onContentReady",function(t){})},struc:function(){l.objectCallFunction(o,"init","loadVendors","loadToolbar","bindEvents","appendHtml","triggerCustomEvent")}};o.struc()},_trigger:function(t,e,a){this.$element.trigger(t,a||""),e&&e.call(this.$element)}};var b={itemtools:function(){var e={itemtools:'<div class="cb-itemtools"><i class="item-move" href="javascript:;"></i><i class="item-delete" href="javascript:;"></i></div>'},a={domCache:function(){var i=t("body");i.append(e.itemtools),t.cbuilder.$itemtools=a.$itemtools=i.find(".cb-itemtools"),a.$contianer=t(".cb-container"),a.$itemdelete=t(".item-delete")},mouseOverEvent:function(){a.$contianer.mouseover(function(a){var i=t(a.target),n=i.parents(o);0===t(".cb-itemtools").length&&t("body").append(e.itemtools),0===t(".jcrop-holder").length&&(n.length>0&&(n.append(t.cbuilder.$itemtools),t.cbuilder.$itemtools.show()),i.hasClass("cb-content")&&(i.append(t.cbuilder.$itemtools),t.cbuilder.$itemtools.show()))}),a.$contianer.mouseout(function(e){var a=t(e.target),i=a.parents(o);0===i.length&&t.cbuilder.$itemtools.hide()})},deleteEvent:function(){t(".item-delete").on("click",function(){var e=t(this);layer.confirm("确定删除该项?",{icon:3},function(t){layer.close(t),e.parents(o).detach()})})},bindEvents:function(){a.mouseOverEvent(),a.deleteEvent()},struc:function(){t(document).ready(function(){a.domCache(),a.bindEvents()})}};a.struc()},propertiesWindow:function(){var e={propertiesWindow:'<div class="cb-propertiesWindow"><div class="cb-pw-openner" id="pwopenner">&#x5C5E;<br>&#x6027;<br>&#x83DC;<br>&#x5355;<br></div><!-- 图片 --><div class="pw-picture pw-panel" id="pwpicture"><div class="pw-header">< IMG ></div><div class="pw-body"><hr class="cb-article-divider"><div class="pw-body-content"><h1 class="pw-body-content-header">&#x5C5E;&#x6027;</h1><table class="pw-body-content-list"><tbody><tr><td class="text">height:</td><td class="input"><input type="text" id="cb-main-height"></td></tr><tr><td class="text">width:</td><td class="input"><input type="text" id="cb-main-width"></td></tr></tbody></table><h1 class="pw-body-content-header">&#x663E;&#x793A;&#x65F6;&#x95F4;</h1><table class="pw-body-content-list"><tbody><tr><td class="text">&#x5F00;&#x59CB;:</td><td class="input"><input type="text" id="cb-main-showdate" onfocus="WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', maxDate: \'#F{$dp.$D(\\\'cb-main-hidedate\\\')||\\\'2030-10-01\\\'}\' }) "></td></tr><tr><td class="text">&#x7ED3;&#x675F;:</td><td class="input"><input type="text" id="cb-main-hidedate" onfocus=" WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', minDate: \'#F{$dp.$D(\\\'cb-main-showdate\\\')}\', maxDate: \'2030-10-01\' }) "></td></tr></tbody></table><hr class="cb-article-divider"></div><div class="pw-body-footer"><button type="button" class="btn primary save">&#x4FDD; &#x5B58;</button><button type="button" class="btn primary delete">&#x5220; &#x9664;</button></div></div></div><!-- 区域 --><div class="pw-area pw-panel" id="pwarea"><div class="pw-header"></div><div class="pw-operate"></div><div class="pw-body"><hr class="cb-article-divider"><ul class="cb-pills"><li class="cb-active"><a href="javascript:;" class="cb-pills-title"></a></li></ul><hr class="cb-article-divider"><div class="pw-body-content"><h1 class="pw-body-content-header">&#x4F4D;&#x7F6E;</h1><table class="pw-body-content-list"><tbody><tr><td class="text">width:</td><td class="input"><input id="cb-area-width" class="cb-area-croppos" data-name="width" maxlength="4" type="text"></td></tr><tr><td class="text">height:</td><td class="input"><input id="cb-area-height" class="cb-area-croppos" data-name="height" maxlength="4" type="text"></td></tr><tr><td class="text">margin-left:</td><td class="input"><input id="cb-area-marginleft" class="cb-area-croppos" data-name="left" maxlength="4" type="text"></td></tr><tr><td class="text">margin-top:</td><td class="input"><input id="cb-area-margintop" class="cb-area-croppos" data-name="top" maxlength="4" type="text"></td></tr></tbody></table><hr class="cb-article-divider"><h1 class="pw-body-content-header">&#x7C7B;&#x578B;</h1><div class="pw-body-content-controls"><div id="cb-area-type"><label for="cb-area-type1"><input id="cb-area-type1" data-type="link" type="radio" name="areatype">&#x94FE;&#x63A5;</label><label for="cb-area-type2"><input id="cb-area-type2" data-type="anchor" type="radio" name="areatype">&#x951A;&#x70B9;</label><label for="cb-area-type3"><input id="cb-area-type3" data-type="countdown" type="radio" name="areatype">&#x5012;&#x8BA1;&#x65F6;</label></div></div><div class="cb-area-type cb-area-type1 pw-controls-panel"><table class="pw-body-content-list"><tbody><tr><td class="text">&#x94FE;&#x63A5;&#x5730;&#x5740;:</td><td class="input"><textarea id="cb-area-url" rows="3" cols="30" style="width: 100%"></textarea></td></tr><tr><td class="text">&#x6253;&#x5F00;&#x65B9;&#x5F0F;:</td><td class="input"><label for="open-type1"><input id="open-type1" data-value="_blank" type="radio" name="opentype" checked="checked">&#x65B0;&#x5EFA;&#x7A97;&#x53E3;</label><label for="open-type2"><input id="open-type2" data-value="_self" type="radio" name="opentype">&#x5F53;&#x524D;&#x7A97;&#x53E3;</label></td></tr></tbody></table></div><div class="cb-area-type cb-area-type2 pw-controls-panel"><select id="cb-area-anchor"></select></div><div class="cb-area-type cb-area-type3 pw-controls-panel"><table class="pw-body-content-list"><tbody><tr><td class="input" colspan="2"><div id="cb-area-fontdemo">8&#x5929;08&#x65F6;08&#x5206;08&#x79D2;</div></td></tr><tr><td class="text">&#x5B57;&#x4F53;:</td><td class="input"><select id="cb-area-fontfamily"><option value="&#x5B8B;&#x4F53;">&#x5B8B;&#x4F53;</option><option value="&#x6977;&#x4F53;">&#x6977;&#x4F53;</option><option value="&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;">&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;</option></select></td></tr><tr><td class="text">&#x5B57;&#x4F53;&#x5927;&#x5C0F;:</td><td class="input"><select id="cb-area-fontsize"></select></td></tr><tr><td class="text">&#x5B57;&#x4F53;&#x989C;&#x8272;:</td><td class="input"><input type="text" id="cb-area-fontcolor" style="display: none"></td></tr><tr><td class="text">&#x5F00;&#x59CB;&#x65F6;&#x95F4;:</td><td class="input"><input type="text" id="cb-area-startdate" onfocus="WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', maxDate: \'#F{$dp.$D(\\\'cb-area-enddate\\\')||\\\'2030-10-01\\\'}\' }) "></td></tr><tr><td class="text">&#x7ED3;&#x675F;&#x65F6;&#x95F4;:</td><td class="input"><input type="text" id="cb-area-enddate" onfocus=" WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', minDate: \'#F{$dp.$D(\\\'cb-area-startdate\\\')}\', maxDate: \'2030-10-01\' }) "></td></tr><tr><td class="text">&#x662F;&#x5426;&#x5929;&#x4E3A;&#x5355;&#x4F4D;:</td><td class="input"><input type="checkbox" id="cb-area-isdayunit"></td></tr></tbody></table></div><hr class="cb-article-divider"></div><div class="pw-body-footer"><div class="pw-body-footer"><button type="button" id="cb-area-save" class="btn primary">&#x4FDD; &#x5B58;</button><button type="button" id="cb-area-delete" class="btn primary delete">&#x5220; &#x9664;</button></div></div></div></div></div>',bodycontentheader:'<h1 class="pw-body-content-header">#value</h1>',hr:'<hr class="cb-article-divider">'};t("body").append(e.propertiesWindow),t("#pwopenner").on("click",function(){var e=t.cbuilder.propertiesWindow.$self.css("right");"0px"!==e||"-345px"===e?t.cbuilder.propertiesWindow.show():t.cbuilder.propertiesWindow.$self.css({right:"-345px"})}),t.cbuilder.propertiesWindow={$self:t("body").find(".cb-propertiesWindow"),$panel:t("body").find(".cb-propertiesWindow").find(".pw-panel"),$selectedobj:"",show:function(e){if(void 0!==e){var a=t("#"+e);this.$self.find(".pw-panel").hide(),a.show(),this.$self.css({right:"0px"}),a.trigger("propertiesWindow:Showing")}else this.$self.css({right:"0px"})},hide:function(){t.cbuilder.propertiesWindow.$self.css({right:"-385px"})}},function(){var e={domCache:function(){var a="cb-main-height,cb-main-width,cb-main-showdate,cb-main-hidedate";e.$pw=t("#pwpicture"),e.$pw.savebtn=e.$pw.find(".pw-body-footer .save"),e.$pw.deletebtn=e.$pw.find(".pw-body-footer .delete"),l.setObjVariable(e,a,"cb-main-")},saveBtnEvent:function(){e.$pw.savebtn.on("click",function(){var a=t.cbuilder.propertiesWindow.$selectedobj,i=e.$pw.find(".pw-body-content-list tr"),n=a.parents(".cb-cropwrap");i.each(function(){var i=t(this),o=i.find(".text").text().replace(/:/,""),d=i.find(".input").find("input").val();a.css(o)?a.css(o,d):a.prop(o)&&a.prop(o,d);var r=e.$showdate.val();""!==r&&n.attr("showdate",r);var c=e.$hidedate.val();""!==c&&n.attr("hidedate",c),l.layer.msg("保存成功"),t.cbuilder.propertiesWindow.hide()})})},deleteBtnEvent:function(){e.$pw.deletebtn.on("click",function(){var e=t.cbuilder.propertiesWindow.$selectedobj,a="确定删除&lt;"+e.prop("tagName")+"&gt;?";layer.confirm(a,{icon:3},function(a){var i="",n=e.parent(".cb-cropwrap");if(0!==n.length)i=1===n.children().length||"IMG"===e.prop("tagName")?n.parents(".cb-item"):e;else{var o=e.parents(".cb-content"),d=e.parents(".cb-item");i=1===o.children().length?d:d}i.detach(),t.cbuilder.propertiesWindow.hide(),layer.close(a)})})},showingEvent:function(){e.$pw.on("propertiesWindow:Showing",function(a){l.clean();var i=t.cbuilder.propertiesWindow.$selectedobj;e.$height.val(i.css("height").replace(/px/,"")),e.$width.val(i.css("width").replace(/px/,""));var n=i.parents(".cb-cropwrap"),o={showdate:"",hidedate:""};e.$showdate.val(n.attr("showdate")||o.showdate),e.$hidedate.val(n.attr("hidedate")||o.hidedate)})},setPanel:function(a){var i=t(a);e.$panel=i,e.$pwcontent=i.find(".pw-body-content"),e.$pwfooter=i.find(".pw-body-footer"),e.$pwheader=i.find(".pw-header")},publicFunction:function(){t.cbuilder.$pw.AddBtn=function(a){var i=t("#"+a.id);if(0===i.length){var n='<button type="button" id="'+a.id+'" class="btn primary">'+a.text+"</button>";e.$pw.find(a.panel+" .pw-body-footer").append(n),"function"==typeof a.event&&a.event(t("#"+a.id))}}},bindEvents:function(){l.objectCallFunction(e,"showingEvent","saveBtnEvent","deleteBtnEvent")},init:function(){var t=["../../../../lib/My97DatePicker/WdatePicker.js","../../../../vendor/spectrum/spectrum.js","../../../../vendor/spectrum/spectrum.css"];l.loadFile(t)},struc:function(){l.objectCallFunction(e,"init","domCache","bindEvents")}};e.struc()}()},struc:function(){t(document).ready(function(){l.objectCallFunction(b,"propertiesWindow","itemtools")})}};b.struc(),t.fn.cbuilder=function(e){var a=arguments;return t(this).each(function(){var i=t(this).data(c),n="object"!=typeof e?null:e;i||(i=new p(this,n),t(this).data(c,i)),"string"==typeof e&&i[e].apply(i,Array.prototype.slice.call(a,1))})}});