!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){function t(){var e=document.querySelectorAll("script[src]"),t=e[e.length-1].src,a=t.split("/"),n=a[a.length-1];return t.replace(n,"")}var a={height:"100%",width:"99%",toolbar:["upload","mupload","test","clean","anchor","preview","picture"],tpl:{toolbar:"<div class='cb-toolbar'></div>",toolbar_button:"<div class='btn-wrap'><button class='btn primary {clsname}'>{name}</button></div>",body:"<div class='cb-body'></div>",body_item:"<div class='cb-item'><div class='cb-content'></div></div>",body_item_tool:"<div class='cb-tools'><div class='btn-wrap'></div></div>"}};!function(t){var a={},n={get:function(t,n){return a[t]&&!n?a[t]:a[t]=e(t)}};t.DOMCache=n}(window);var n=".cb-toolbar",i=".cb-body",o=".cb-content",r=".cb-item",c="originhtml",d="cbuilder",s=t(),l={loadFile:function(t){for(var a=0;a<t.length;a++){var n=t[a];if(n.indexOf("css")>=0){var i=e("<link rel='stylesheet' type='text/css' href='"+n+"'>");e("head").append(i)}else e.ajax({async:!1,url:n})}},setObjVariable:function(t,a,n){if(void 0!=a&&"string"==typeof a){a=a.split(",");for(var i=0;i<a.length;i++){var o=a[i];n&&(o=o.replace(n,""));var r="#";a[i].indexOf(".")>=0&&(o=o.replace(/\./gi,""),r=""),t["$"+o]=e(r+a[i])}}},clean:function(){"undefined"!=typeof jcrop_api&&(jcrop_api.destroy(),jcrop_api.release(),delete jcrop_api),e.cbuilder.$pw.$selectedobj.hasClass("imgpos-active")&&e.cbuilder.$pw.$selectedobj.remove(),e.cbuilder.active.$element.find("img").css("visibility",""),e("#tempimgpos").removeAttr("id")},objectCallFunction:function(e){for(var t,a=1;a<arguments.length;a++)t=e[arguments[a]],"function"==typeof t&&t()},regex:{url:/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/},layer:{msg:function(e){layer.msg(e,{time:2e3,offset:"200px"})}},propertiesWindow:{show:function(){var t=e("body").find(".cb-propertiesWindow");t.css({right:"0px"})},hide:function(t){var a=e("body").find(".cb-propertiesWindow");a.css(void 0!==t?{right:t}:{right:"-385px"})}}},p=function(t,n){this.options=e.extend({},a,n),this.$element=e(t),this.strucView()};e.cbuilder={append:function(t){e.cbuilder.active.$element.find(i).append(t),e.cbuilder.active._trigger("cbuilder:onWrapContent"),e.cbuilder.active._trigger("cbuilder:onContentReady")},item:{tools:{addbtn:function(t){var a="<a href='javascript:;'>"+t.text+"</a>",n=this.element.parents(r).find(".btn-wrap");n.append(a),t.click&&n.find("a:last").on("click",function(){t.click(e(this))})}}},getContent:function(){e.cbuilder.active._trigger("cbuilder:onGetContentBefore");var t="";return t=e.cbuilder.active._content?'<div class="'+d+'">'+e.cbuilder.active._content+"</div>":this._getItemsObject().html()},_getItemsObject:function(){var t=e.cbuilder.active.$element.clone(),a=t.find(".cb-body");return a}},p.prototype={strucView:function(){var t=this,a=t.options;t.$element.data("cbuilder",t);var o={init:function(){var e=t.$element;e.data(c,e.html()),e.html(""),e.addClass("cb-container").wrap(a.tpl.container).append(a.tpl.toolbar+a.tpl.body),e.width(a.width).height(a.height),o.$body=e.find(i)},loadVendors:function(){var e=["../../vendor/layer/layer.js","../../vendor/layer/skin/layer.css","../../vendor/dragula.js/dist/dragula.min.js","../../vendor/dragula.js/dist/dragula.min.css","../../vendor/jQuery-contextMenu/src/jquery.contextMenu.js","../../vendor/jQuery-contextMenu/src/jquery.contextMenu.css"];l.loadFile(e)},loadToolbar:function(){for(var a=t.options.toolbar.length,i=0;a>i;i++){var o=t.options.toolbar[i],r="src/js/toolbar/"+o+"/main.js";e.ajax({async:!1,type:"get",url:r,success:function(){var a=init(t.$element,s,l);if(a.isToolbar===!1)return a.onLoaded(),!1;var i="cb-"+a.toolbar.name;if(a.toolbar.text){t.$element.find(n).append(t.options.tpl.toolbar_button.replace(/\{name\}/,a.toolbar.text).replace(/\{clsname\}/,i)),t._trigger("",a.onLoaded);var o=t.$element.find("."+i);o.on("click",function(){if(e.cbuilder.active=t,"iframe"===a.type){var n=void 0!==a.width?a.width+"px":"95%",i=void 0!==a.height?a.height+"px":"95%";layer.open({type:2,title:a.toolbar.text,shadeClose:!0,shade:.3,area:[n,i],content:s+"toolbar/"+a.toolbar.name+"/main.html"})}t._trigger("",a.toolbar.onClick)})}else"function"==typeof a.onLoaded&&a.onLoaded()}})}},appendHtml:function(){o.$body.html(t.$element.data(c)),t.$element.data(c,"")},triggerCustomEvent:function(){e(document).ready(function(){t._trigger("cbuilder:onWrapContent"),t._trigger("cbuilder:onContentReady")})},bindEvents:function(){var a=t.$element.find(i);t.$element.on("cbuilder:onWrapContent",function(n){a.children(":not("+r+")").each(function(){var a=e(this);a.wrap(t.options.tpl.body_item),e.cbuilder.active=t})}),dragula(a[0],{moves:function(e,t,a){return"item-move"===a.className}}),t.$element.on("cbuilder:onContentReady",function(e){})},struc:function(){l.objectCallFunction(o,"init","loadVendors","loadToolbar","bindEvents","appendHtml","triggerCustomEvent")}};o.struc()},_trigger:function(e,t,a){this.$element.trigger(e,a||""),t&&t.call(this.$element)}};var u={itemtools:function(){var t={itemtools:'<div class="cb-itemtools"><i class="item-move" href="javascript:;"></i><i class="item-delete" href="javascript:;"></i></div>'},a={domCache:function(){var n=e("body");n.append(t.itemtools),e.cbuilder.$itemtools=a.$itemtools=n.find(".cb-itemtools"),a.$contianer=e(".cb-container"),a.$itemdelete=e(".item-delete")},mouseOverEvent:function(){a.$contianer.mouseover(function(a){var n=e(a.target),i=n.parents(o);0===e(".cb-itemtools").length&&e("body").append(t.itemtools),0===e(".jcrop-holder").length&&(i.length>0&&(i.append(e.cbuilder.$itemtools),e.cbuilder.$itemtools.show()),n.hasClass("cb-content")&&(n.append(e.cbuilder.$itemtools),e.cbuilder.$itemtools.show()))}),a.$contianer.mouseout(function(t){var a=e(t.target),n=a.parents(o);0===n.length&&e.cbuilder.$itemtools.hide()})},deleteEvent:function(){e(".item-delete").on("click",function(){var t=e(this);layer.confirm("确定删除该项?",{icon:3},function(e){layer.close(e),t.parents(o).detach()})})},bindEvents:function(){a.mouseOverEvent(),a.deleteEvent()},struc:function(){e(document).ready(function(){a.domCache(),a.bindEvents()})}};a.struc()},propertiesWindow:function(){var t={typeEvent:function(){t.$type.delegate("input","click",function(){var a=e(this),i=a.attr("id"),r=t.selecteType=a.data("type"),c=n.$panel.find(".pw-controls-panel"),d=e.cbuilder.$pw.$selectedobj,s="",l={};switch(c.hide(),r){case"link":l={url:"",opentype:"_blank"},t.$url.val(d.attr("href")||l.url),e.cbuilder.active.$element.find('input[name="opentype"][data-value="'+(d.attr("target")||l.opentype)+'"]').trigger("click");break;case"anchor":var p=e.cbuilder.active.$element.find(o).find(".cb-anchor"),u=t.$anchor;0===p.length?u.html("<option>没有锚点</option>"):(p.each(function(){var t=e(this).attr("id");s+="<option value="+t+">"+t+"</option>"}),u.html(s),d.attr("href")&&u.find("option[value='"+d.attr("href").replace(/#/,"")+"']").prop("selected","selected"));break;case"countdown":for(var f=14;40>f;f+=2)s+='<option value="'+f+'">'+f+"px</option>";if(t.$fontsize.html(s),null!==d.prop("style").cssText.toString().match(/font-size/)){var b=d.css("font-size");t.$fontsize.find("option[value="+b.replace(/px/,"")+"]").prop("selected","selected"),t.$fontdemo.css("font-size",b)}if(l={color:"#000",startdate:"",enddate:"",isdayunit:"true"},t.$startdate.val(d.attr("startdate")||l.startdate),t.$enddate.val(d.attr("enddate")||l.enddate),null!==d.prop("style").cssText.toString().match(/font-family/)){var v=d.css("font-family");t.$fontfamily.find('option[value="'+v+'"]').prop("selected","selected"),t.$fontdemo.css("font-family",v)}t.$fontcolor.spectrum({showPalette:!0,color:d.css("color")||l.color,showInput:!0,preferredFormat:"hex",hideAfterPaletteSelect:!0,clickoutFiresChange:!0,showButtons:!0,chooseText:"选择",cancelText:"取消",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(e){t.$fontdemo.css("color",e.toHexString())}}),"undefined"==typeof d.attr("isdayunit")?t.$isdayunit.prop("checked","true"):"true"===d.attr("isdayunit")?t.$isdayunit.prop("checked","true"):t.$isdayunit.prop("checked","")}n.$panel.find(".pw-controls-panel[class*="+i+"]").show()})},backEvent:function(){n.$pw.find(".pw-area .back").on("click",function(){e.cbuilder.$pw.trigger("propertiesWindow:show")})},cropPosInputEvent:function(){t.$croppos.on("keypress",function(e){isNaN(String.fromCharCode(e.which))&&e.preventDefault()}),t.$croppos.on("keyup",function(a){var n=a.keyCode;32===n?a.returnValue=!1:n>=48&&57>=n||n>=96&&105>=n||8===n||46===n?(a.returnValue=!0,setTimeout(function(){var n=parseInt(t.$width.val()),i=parseInt(t.$height.val()),o=parseInt(t.$marginleft.val()),r=parseInt(t.$margintop.val()),c=e(a.target),d=c.data("name"),s=parseInt(a.target.value)||0;"width"===d&&(n=s),"height"===d&&(i=s),"left"===d&&(o=s),"top"===d&&(r=s),"undefined"!=typeof jcrop_api&&(jcrop_api.animateTo([n+o,i+r,o,r]),e.cbuilder.areapos={w:n,h:i,x:o,y:r})},200)):a.returnValue=!1})},customEvent:function(){n.$pw.on("propertiesWindow:editShowEd",function(a,i,o){e.cbuilder.$itemtools.hide();var r="";"area"===o&&(n.setPanel(".pw-area"),r="当前区域"),n.$pwallpanel.hide(),n.$panel.show(),n.$pwheader.text("<"+r+">"),t.$width.val(e.cbuilder.areapos.w),t.$height.val(e.cbuilder.areapos.h),t.$marginleft.val(e.cbuilder.areapos.x),t.$margintop.val(e.cbuilder.areapos.y),n.$panel.find(".cb-pills-title").text(i),e.cbuilder.$pw.trigger("propertiesWindow:areaTypeShow"),l.propertiesWindow.show()}),n.$pw.on("propertiesWindow:areaTypeShow",function(){var a=e.cbuilder.$pw.$selectedobj,n=a.attr("linktype");n?t.$type.find("input[data-type="+n+"]").trigger("click"):t.$type.find("input:eq(0)").trigger("click")}),n.$pw.on("propertiesWindow:areaTypeSave",function(){var a,n=t.selecteType,i="",r="a";switch(n){case"link":var c=e.trim(t.$url.val()).toString(),d=e('input[name="opentype"]:checked').data("value");if(!c.match(l.regex.url))return l.layer.msg("保存失败:请输入正确的链接地址"),!1;i+='target="'+d+'"',i+='href="'+c+'"';break;case"anchor":var s=e.cbuilder.active.$element.find(o).find(".cb-anchor");if(0===s.length)return l.layer.msg("保存失败:请添加锚点"),!1;i+='href="#'+t.$anchor.val()+'"';break;case"countdown":if(r="div",t.startdate=t.$startdate.val(),t.enddate=t.$enddate.val(),t.isdayunit=t.$isdayunit.prop("checked"),""===t.startdate)return l.layer.msg("保存失败:请选择开始时间"),!1;if(""===t.enddate)return l.layer.msg("保存失败:请选择结束时间"),!1;a=function(){var a=e("#tempimgpos");a.css("font-family",t.$fontfamily.val()),a.css("font-size",t.$fontsize.val()+"px"),a.css("color",t.$fontcolor.spectrum("get").toHexString()),a.attr("startdate",t.startdate),a.attr("enddate",t.enddate),a.attr("isdayunit",t.isdayunit)}}i+=' linktype="'+n+'"';var p=e.cbuilder.areapos.w-6,u=e.cbuilder.areapos.h-6,f=e.cbuilder.areapos.x,b=e.cbuilder.areapos.y,v="left:"+f+"px;top:"+b+"px;width:"+p+"px;height:"+u+"px;",h="<"+r+' class="imgpos" id="tempimgpos" style="'+v+'"  '+i+" ></"+r+">",y=e.cbuilder.$pw.$selectedobj.parent();y.append(h),"function"==typeof a&&a(),l.clean(),layer.msg("保存成功",{offset:"200px",time:1e3}),l.propertiesWindow.hide()})},deleteBtnEvent:function(){t.$delete.on("click",function(){layer.confirm("确定删除<当前区域>?",{icon:3},function(e){l.clean(),l.propertiesWindow.hide(),layer.close(e)})})},saveBtnEvent:function(){t.$save.on("click",function(){"undefined"!=typeof jcrop_api&&e.cbuilder.$pw.trigger("propertiesWindow:areaTypeSave")})},countDownEvent:function(){t.$fontfamily.change(function(){t.$fontdemo.css("font-family",e(this).val())}),t.$fontsize.change(function(){t.$fontdemo.css("font-size",e(this).val()+"px"),t.$fontdemo.css("line-height",e(this).val()+"px")})},bindEvents:function(){l.objectCallFunction(t,"cropPosInputEvent","saveBtnEvent","deleteBtnEvent","typeEvent","countDownEvent")},domCache:function(){var e="cb-area-type,cb-area-url,.cb-area-croppos,cb-area-width,cb-area-height,cb-area-marginleft,cb-area-margintop,cb-area-anchor,pw-area",a=",cb-area-save,cb-area-delete",n=",cb-area-fontfamily,cb-area-fontsize,cb-area-fontdemo,cb-area-fontcolor,cb-area-startdate,cb-area-enddate,cb-area-isdayunit";e+=a+n,l.setObjVariable(t,e,"cb-area-")},struc:function(){l.objectCallFunction(t,"domCache","customEvent","bindEvents")}};t.struc();var a={propertiesWindow:'<div class="cb-propertiesWindow"><div class="cb-pw-openner">&#x5C5E;<br>&#x6027;<br>&#x83DC;<br>&#x5355;<br></div><!-- 主面板 --><div class="pw-main pw-panel" style="display: block"><div class="pw-header"></div><div class="pw-operate"></div><div class="pw-body"><hr class="cb-article-divider"><ul class="cb-pills"><li><a href="javascript:;" class="cb-pills-title">&#x7F16;&#x8F91;</a></li></ul><hr class="cb-article-divider"><div class="pw-body-content"><h1 class="pw-body-content-header">&#x5C5E;&#x6027;</h1><table class="pw-body-content-list"><tbody><tr><td class="text">height:</td><td class="input"><input type="text" id="cb-main-height"></td></tr><tr><td class="text">width:</td><td class="input"><input type="text" id="cb-main-width"></td></tr></tbody></table><h1 class="pw-body-content-header">&#x663E;&#x793A;&#x65F6;&#x95F4;</h1><table class="pw-body-content-list"><tbody><tr><td class="text">&#x5F00;&#x59CB;:</td><td class="input"><input type="text" id="cb-main-showdate" onfocus="WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', maxDate: \'#F{$dp.$D(\\\'cb-main-hidedate\\\')||\\\'2030-10-01\\\'}\' }) "></td></tr><tr><td class="text">&#x7ED3;&#x675F;:</td><td class="input"><input type="text" id="cb-main-hidedate" onfocus=" WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', minDate: \'#F{$dp.$D(\\\'cb-main-showdate\\\')}\', maxDate: \'2030-10-01\' }) "></td></tr></tbody></table><hr class="cb-article-divider"></div><div class="pw-body-footer"><button type="button" class="btn primary save">&#x4FDD; &#x5B58;</button><button type="button" class="btn primary delete">&#x5220; &#x9664;</button></div></div></div><!-- 区域 --><div class="pw-area pw-panel"><div class="pw-header"></div><div class="pw-operate"><!--<a class="back" href="javascript:;"></a>--></div><div class="pw-body"><hr class="cb-article-divider"><ul class="cb-pills"><li class="cb-active"><a href="javascript:;" class="cb-pills-title"></a></li></ul><hr class="cb-article-divider"><div class="pw-body-content"><h1 class="pw-body-content-header">&#x4F4D;&#x7F6E;</h1><table class="pw-body-content-list"><tbody><tr><td class="text">width:</td><td class="input"><input id="cb-area-width" class="cb-area-croppos" data-name="width" maxlength="4" type="text"></td></tr><tr><td class="text">height:</td><td class="input"><input id="cb-area-height" class="cb-area-croppos" data-name="height" maxlength="4" type="text"></td></tr><tr><td class="text">margin-left:</td><td class="input"><input id="cb-area-marginleft" class="cb-area-croppos" data-name="left" maxlength="4" type="text"></td></tr><tr><td class="text">margin-top:</td><td class="input"><input id="cb-area-margintop" class="cb-area-croppos" data-name="top" maxlength="4" type="text"></td></tr></tbody></table><hr class="cb-article-divider"><h1 class="pw-body-content-header">&#x7C7B;&#x578B;</h1><div class="pw-body-content-controls"><div id="cb-area-type"><label for="cb-area-type1"><input id="cb-area-type1" data-type="link" type="radio" name="areatype">&#x94FE;&#x63A5;</label><label for="cb-area-type2"><input id="cb-area-type2" data-type="anchor" type="radio" name="areatype">&#x951A;&#x70B9;</label><label for="cb-area-type3"><input id="cb-area-type3" data-type="countdown" type="radio" name="areatype">&#x5012;&#x8BA1;&#x65F6;</label></div></div><div class="cb-area-type cb-area-type1 pw-controls-panel"><table class="pw-body-content-list"><tbody><tr><td class="text">&#x94FE;&#x63A5;&#x5730;&#x5740;:</td><td class="input"><textarea id="cb-area-url" rows="3" cols="30" style="width: 100%"></textarea></td></tr><tr><td class="text">&#x6253;&#x5F00;&#x65B9;&#x5F0F;:</td><td class="input"><label for="open-type1"><input id="open-type1" data-value="_blank" type="radio" name="opentype" checked="checked">&#x65B0;&#x5EFA;&#x7A97;&#x53E3;</label><label for="open-type2"><input id="open-type2" data-value="_self" type="radio" name="opentype">&#x5F53;&#x524D;&#x7A97;&#x53E3;</label></td></tr></tbody></table></div><div class="cb-area-type cb-area-type2 pw-controls-panel"><select id="cb-area-anchor"></select></div><div class="cb-area-type cb-area-type3 pw-controls-panel"><table class="pw-body-content-list"><tbody><tr><td class="input" colspan="2"><div id="cb-area-fontdemo">8&#x5929;08&#x65F6;08&#x5206;08&#x79D2;</div></td></tr><tr><td class="text">&#x5B57;&#x4F53;:</td><td class="input"><select id="cb-area-fontfamily"><option value="&#x5B8B;&#x4F53;">&#x5B8B;&#x4F53;</option><option value="&#x6977;&#x4F53;">&#x6977;&#x4F53;</option><option value="&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;">&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;</option></select></td></tr><tr><td class="text">&#x5B57;&#x4F53;&#x5927;&#x5C0F;:</td><td class="input"><select id="cb-area-fontsize"></select></td></tr><tr><td class="text">&#x5B57;&#x4F53;&#x989C;&#x8272;:</td><td class="input"><input type="text" id="cb-area-fontcolor" style="display: none"></td></tr><tr><td class="text">&#x5F00;&#x59CB;&#x65F6;&#x95F4;:</td><td class="input"><input type="text" id="cb-area-startdate" onfocus="WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', maxDate: \'#F{$dp.$D(\\\'cb-area-enddate\\\')||\\\'2030-10-01\\\'}\' }) "></td></tr><tr><td class="text">&#x7ED3;&#x675F;&#x65F6;&#x95F4;:</td><td class="input"><input type="text" id="cb-area-enddate" onfocus=" WdatePicker({ dateFmt: \'yyyy-MM-dd HH:mm:ss\', minDate: \'#F{$dp.$D(\\\'cb-area-startdate\\\')}\', maxDate: \'2030-10-01\' }) "></td></tr><tr><td class="text">&#x662F;&#x5426;&#x5929;&#x4E3A;&#x5355;&#x4F4D;:</td><td class="input"><input type="checkbox" id="cb-area-isdayunit"></td></tr><!--<tr>--><!--<td class="text">是否显示时分秒:</td>--><!--<td class="input">--><!--<input type=\'checkbox\' id="cb-area-issuffix"/>--><!--</td>--><!--</tr>--></tbody></table></div><hr class="cb-article-divider"></div><div class="pw-body-footer"><div class="pw-body-footer"><button type="button" id="cb-area-save" class="btn primary ">&#x4FDD; &#x5B58;</button><button type="button" id="cb-area-delete" class="btn primary delete">&#x5220; &#x9664;</button></div></div></div></div></div>',bodycontentheader:'<h1 class="pw-body-content-header">#value</h1>',hr:'<hr class="cb-article-divider">'},n={domCache:function(){var t=e("body");t.append(a.propertiesWindow),e.cbuilder.$pw=n.$pw=t.find(".cb-propertiesWindow"),n.$pwallpanel=n.$pw.find(".pw-panel");var i="cb-main-height,cb-main-width,cb-main-showdate,cb-main-hidedate";l.setObjVariable(n,i,"cb-main-")},btnsEvent:function(){n.setPanel(".pw-main");var t=n.$pwfooter.find(".save");t.on("click",function(){var t=e(n.$pw.$selectedobj),a=n.$pwcontent.find(".pw-body-content-list tr"),i=t.parents(".cb-cropwrap");a.each(function(){var a=e(this),o=a.find(".text").text().replace(/:/,""),r=a.find(".input").find("input").val();t.css(o)?t.css(o,r):t.prop(o)&&t.prop(o,r);var c=n.$showdate.val();""!==c&&i.attr("showdate",c);var d=n.$hidedate.val();""!==d&&i.attr("hidedate",d),l.layer.msg("保存成功"),l.propertiesWindow.hide()})});var a=n.$pwfooter.find(".delete");a.on("click",function(){var t=e(n.$pw.$selectedobj),a="确定删除&lt;"+t.prop("tagName")+"&gt;?";layer.confirm(a,{icon:3},function(e){var a="",n=t.parent(".cb-cropwrap");if(0!==n.length)a=1===n.children().length||"IMG"===t.prop("tagName")?n.parents(".cb-item"):t;else{var i=t.parents(".cb-content"),o=t.parents(".cb-item");a=1===i.children().length?o:o}a.detach(),l.propertiesWindow.hide(),layer.close(e)})})},opennerEvent:function(){n.$pw.find(".cb-pw-openner").on("click",function(){"0px"!==n.$pw.css("right")?l.propertiesWindow.show():l.propertiesWindow.hide("-345px")})},pillsEvent:function(){n.$pw.find("ul").delegate("li","click",function(t,a){var i=e(this),o="cb-active",r=a||i.index(),c=i.parents(".pw-panel"),d="";c.hasClass("pw-main")&&(d=".pw-main",n.setPanel(d)),e.cbuilder.$pw.trigger("propertiesWindow:editShowing",n.$pw.$selectedobj),i.parent().find("li").removeClass(o).eq(r).addClass(o),n.$pw.selectedindex=r,n.$pw.find(d).show(),l.propertiesWindow.show()}),n.btnsEvent()},customEvent:function(){n.$pw.on("propertiesWindow:show",function(t){l.clean(),n.$pwallpanel.hide();var a=e(n.$pw.$selectedobj);n.$pw.find(".pw-main .pw-header").text("<"+a.prop("tagName")+">"),n.$pw.find(".pw-main .cb-pills li:first").trigger("click",0||n.$pw.selectedindex),n.$height.val(n.$pw.$selectedobj.css("height").replace(/px/,"")),n.$width.val(n.$pw.$selectedobj.css("width").replace(/px/,""));var i=a.parents(".cb-cropwrap"),o={showdate:"",hidedate:""};n.$showdate.val(i.attr("showdate")||o.showdate),n.$hidedate.val(i.attr("hidedate")||o.hidedate)})},setPanel:function(t){var a=e(t);n.$panel=a,n.$pwcontent=a.find(".pw-body-content"),n.$pwfooter=a.find(".pw-body-footer"),n.$pwheader=a.find(".pw-header")},publicFunction:function(){e.cbuilder.$pw.AddBtn=function(t){var a=e("#"+t.id);if(0===a.length){var i='<button type="button" id="'+t.id+'" class="btn primary">'+t.text+"</button>";n.$pw.find(t.panel+" .pw-body-footer").append(i),"function"==typeof t.event&&t.event(e("#"+t.id))}}},blockInit:function(){var t={typeEvent:function(){t.$type.delegate("input","click",function(){var a=e(this),i=a.attr("id"),r=t.selecteType=a.data("type"),c=n.$panel.find(".pw-controls-panel"),d=e.cbuilder.$pw.$selectedobj,s="",l={};switch(c.hide(),r){case"link":l={url:"",opentype:"_blank"},t.$url.val(d.attr("href")||l.url),e.cbuilder.active.$element.find('input[name="opentype"][data-value="'+(d.attr("target")||l.opentype)+'"]').trigger("click");break;case"anchor":var p=e.cbuilder.active.$element.find(o).find(".cb-anchor"),u=t.$anchor;0===p.length?u.html("<option>没有锚点</option>"):(p.each(function(){var t=e(this).attr("id");s+="<option value="+t+">"+t+"</option>"}),u.html(s),d.attr("href")&&u.find("option[value='"+d.attr("href").replace(/#/,"")+"']").prop("selected","selected"));break;case"countdown":for(var f=14;40>f;f+=2)s+='<option value="'+f+'">'+f+"px</option>";if(t.$fontsize.html(s),null!==d.prop("style").cssText.toString().match(/font-size/)){var b=d.css("font-size");t.$fontsize.find("option[value="+b.replace(/px/,"")+"]").prop("selected","selected"),t.$fontdemo.css("font-size",b)}if(l={color:"#000",startdate:"",enddate:"",isdayunit:"true"},t.$startdate.val(d.attr("startdate")||l.startdate),t.$enddate.val(d.attr("enddate")||l.enddate),null!==d.prop("style").cssText.toString().match(/font-family/)){var v=d.css("font-family");t.$fontfamily.find('option[value="'+v+'"]').prop("selected","selected"),t.$fontdemo.css("font-family",v)}t.$fontcolor.spectrum({showPalette:!0,color:d.css("color")||l.color,showInput:!0,preferredFormat:"hex",hideAfterPaletteSelect:!0,clickoutFiresChange:!0,showButtons:!0,chooseText:"选择",cancelText:"取消",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(e){t.$fontdemo.css("color",e.toHexString())}}),"undefined"==typeof d.attr("isdayunit")?t.$isdayunit.prop("checked","true"):"true"===d.attr("isdayunit")?t.$isdayunit.prop("checked","true"):t.$isdayunit.prop("checked","")}n.$panel.find(".pw-controls-panel[class*="+i+"]").show()})},backEvent:function(){n.$pw.find(".pw-area .back").on("click",function(){e.cbuilder.$pw.trigger("propertiesWindow:show")})},cropPosInputEvent:function(){t.$croppos.on("keypress",function(e){isNaN(String.fromCharCode(e.which))&&e.preventDefault()}),t.$croppos.on("keyup",function(a){var n=a.keyCode;32===n?a.returnValue=!1:n>=48&&57>=n||n>=96&&105>=n||8===n||46===n?(a.returnValue=!0,setTimeout(function(){var n=parseInt(t.$width.val()),i=parseInt(t.$height.val()),o=parseInt(t.$marginleft.val()),r=parseInt(t.$margintop.val()),c=e(a.target),d=c.data("name"),s=parseInt(a.target.value)||0;"width"===d&&(n=s),"height"===d&&(i=s),"left"===d&&(o=s),"top"===d&&(r=s),"undefined"!=typeof jcrop_api&&(jcrop_api.animateTo([n+o,i+r,o,r]),e.cbuilder.areapos={w:n,h:i,x:o,y:r})},200)):a.returnValue=!1})},customEvent:function(){n.$pw.on("propertiesWindow:editShowEd",function(a,i,o){e.cbuilder.$itemtools.hide();var r="";"area"===o&&(n.setPanel(".pw-area"),r="当前区域"),n.$pwallpanel.hide(),n.$panel.show(),n.$pwheader.text("<"+r+">"),t.$width.val(e.cbuilder.areapos.w),t.$height.val(e.cbuilder.areapos.h),t.$marginleft.val(e.cbuilder.areapos.x),t.$margintop.val(e.cbuilder.areapos.y),n.$panel.find(".cb-pills-title").text(i),e.cbuilder.$pw.trigger("propertiesWindow:areaTypeShow"),l.propertiesWindow.show()}),n.$pw.on("propertiesWindow:areaTypeShow",function(){var a=e.cbuilder.$pw.$selectedobj,n=a.attr("linktype");n?t.$type.find("input[data-type="+n+"]").trigger("click"):t.$type.find("input:eq(0)").trigger("click")}),n.$pw.on("propertiesWindow:areaTypeSave",function(){var a,n=t.selecteType,i="",r="a";switch(n){case"link":var c=e.trim(t.$url.val()).toString(),d=e('input[name="opentype"]:checked').data("value");if(!c.match(l.regex.url))return l.layer.msg("保存失败:请输入正确的链接地址"),!1;i+='target="'+d+'"',i+='href="'+c+'"';break;case"anchor":var s=e.cbuilder.active.$element.find(o).find(".cb-anchor");if(0===s.length)return l.layer.msg("保存失败:请添加锚点"),!1;i+='href="#'+t.$anchor.val()+'"';break;case"countdown":if(r="div",t.startdate=t.$startdate.val(),t.enddate=t.$enddate.val(),t.isdayunit=t.$isdayunit.prop("checked"),""===t.startdate)return l.layer.msg("保存失败:请选择开始时间"),!1;if(""===t.enddate)return l.layer.msg("保存失败:请选择结束时间"),!1;a=function(){var a=e("#tempimgpos");a.css("font-family",t.$fontfamily.val()),a.css("font-size",t.$fontsize.val()+"px"),a.css("color",t.$fontcolor.spectrum("get").toHexString()),a.attr("startdate",t.startdate),a.attr("enddate",t.enddate),a.attr("isdayunit",t.isdayunit)}}i+=' linktype="'+n+'"';var p=e.cbuilder.areapos.w-6,u=e.cbuilder.areapos.h-6,f=e.cbuilder.areapos.x,b=e.cbuilder.areapos.y,v="left:"+f+"px;top:"+b+"px;width:"+p+"px;height:"+u+"px;",h="<"+r+' class="imgpos" id="tempimgpos" style="'+v+'"  '+i+" ></"+r+">",y=e.cbuilder.$pw.$selectedobj.parent();y.append(h),"function"==typeof a&&a(),l.clean(),layer.msg("保存成功",{offset:"200px",time:1e3}),l.propertiesWindow.hide()})},deleteBtnEvent:function(){t.$delete.on("click",function(){layer.confirm("确定删除<当前区域>?",{icon:3},function(e){l.clean(),l.propertiesWindow.hide(),layer.close(e)})})},saveBtnEvent:function(){t.$save.on("click",function(){"undefined"!=typeof jcrop_api&&e.cbuilder.$pw.trigger("propertiesWindow:areaTypeSave")})},countDownEvent:function(){t.$fontfamily.change(function(){t.$fontdemo.css("font-family",e(this).val())}),t.$fontsize.change(function(){t.$fontdemo.css("font-size",e(this).val()+"px"),t.$fontdemo.css("line-height",e(this).val()+"px")})},bindEvents:function(){l.objectCallFunction(t,"cropPosInputEvent","saveBtnEvent","deleteBtnEvent","typeEvent","countDownEvent")},domCache:function(){var e="cb-area-type,cb-area-url,.cb-area-croppos,cb-area-width,cb-area-height,cb-area-marginleft,cb-area-margintop,cb-area-anchor,pw-area",a=",cb-area-save,cb-area-delete",n=",cb-area-fontfamily,cb-area-fontsize,cb-area-fontdemo,cb-area-fontcolor,cb-area-startdate,cb-area-enddate,cb-area-isdayunit";e+=a+n,l.setObjVariable(t,e,"cb-area-")},struc:function(){l.objectCallFunction(t,"domCache","customEvent","bindEvents")}};t.struc()},bindEvents:function(){l.objectCallFunction(n,"customEvent","opennerEvent","pillsEvent")},init:function(){var e=["../../../../lib/My97DatePicker/WdatePicker.js","../../../../vendor/spectrum/spectrum.js","../../../../vendor/spectrum/spectrum.css"];l.loadFile(e)},struc:function(){l.objectCallFunction(n,"init","domCache","publicFunction","bindEvents","blockInit")}};n.struc(),cosnole.log(213123)},struc:function(){e(document).ready(function(){l.objectCallFunction(u,"propertiesWindow","itemtools")})}};u.struc(),e.fn.cbuilder=function(t){var a=arguments;return e(this).each(function(){var n=e(this).data(d),i="object"!=typeof t?null:t;n||(n=new p(this,i),e(this).data(d,n)),"string"==typeof t&&n[t].apply(n,Array.prototype.slice.call(a,1))})}});