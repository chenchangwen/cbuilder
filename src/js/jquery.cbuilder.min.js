!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){var t,a,i={height:"100%",width:"99%",toolbar:["upload","mupload","test","clean","anchor","preview","picture","sourcecode","picker","unslider","SuperSlide"],tpl:{toolbar:"<div class='cb-toolbar'></div>",toolbar_button:"<div class='btn-wrap'><button class='btn btn-primary btn-sm {clsname}'>{name}</button></div>",body:"<div class='cb-body'></div>",body_item:"<div class='cb-item'><div class='cb-content'></div></div>",body_item_tool:"<div class='cb-tools'><div class='btn-wrap'></div></div>"}},o=".cb-toolbar",r=".cb-body",n=".cb-content",c=".cb-item",l="originhtml",s="cbuilder";!function(){var e=document.querySelectorAll("script[src]"),i=e[e.length-1].src,o=i.split("/"),r=o[o.length-1];t=i.replace(r,""),a=t.replace(/cbuilder\/src\/js\//,"cbuilder/"),t.indexOf("src/js")&&(a=t.replace(/\/src\/js/,""))}();var d={loadFile:function(t){for(var a=0;a<t.length;a++){var i=e.cbuilder.path.root+t[a];if(i.indexOf("css")>=0){var o=e("<link rel='stylesheet' type='text/css' href='"+i+"'>");e("head").append(o)}else e.ajax({async:!1,url:i})}},setObjVariable:function(t,a,i){if(void 0!=a&&"string"==typeof a){a=a.split(",");for(var o=0;o<a.length;o++){var r=a[o];i&&(r=r.replace(i,""));var n="#";a[o].indexOf(".")>=0&&(r=r.replace(/\./gi,""),n=""),t["$"+r]=e(n+a[o])}}},removeImpos:function(){"undefined"!=typeof jcrop_api&&(jcrop_api.destroy(),jcrop_api.release(),delete jcrop_api),e.cbuilder.propertiesWindow.$selectedobj.hasClass("imgpos-active")&&e.cbuilder.propertiesWindow.$selectedobj.remove(),e.cbuilder.active.$element.find("img").css("visibility",""),e("#tempimgpos").removeAttr("id")},objectCallFunction:function(e){for(var t,a=1;a<arguments.length;a++)t=e[arguments[a]],"function"==typeof t&&t()},regex:{url:/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/,number:/^[0-9]*[1-9][0-9]*$/},formatDate:function(e,t){if(e){switch(t||(t="yyyy-MM-dd"),typeof e){case"string":e=new Date(e.replace(/-/,"/"));break;case"number":e=new Date(e)}if(!(!e instanceof Date)){var a={yyyy:e.getFullYear(),M:e.getMonth()+1,d:e.getDate(),H:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),MM:(""+(e.getMonth()+101)).substr(1),dd:(""+(e.getDate()+100)).substr(1),HH:(""+(e.getHours()+100)).substr(1),mm:(""+(e.getMinutes()+100)).substr(1),ss:(""+(e.getSeconds()+100)).substr(1)};return t.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g,function(){return a[arguments[0]]})}}},dateTimePicker:{reduceOneDay:function(e){var t=new Date(e),a=t.getTime()-864e5,i=new Date(a);return i},format:function(e){return""===e?!1:d.formatDate(e,"yyyy/MM/dd")}},layer:{msg:function(e,t,a){var i="";switch(e){case"warning":i="保存失败";break;case"success":i="保存成功"}t&&(i=""!==i?i+":"+t:t),layer.msg(i,{time:1500,offset:"400px"}),d.judge.isJquery(a)&&a.focus()}},jcrop:{load:function(t,a){"undefined"!=typeof jcrop_api?(jcrop_api.release(),jcrop_api.animateTo([100,100,0,0]),e.cbuilder.areapos={w:100,h:100,x:0,y:0}):t.Jcrop({onSelect:function(t){e.cbuilder.areapos={w:t.w,h:t.h,x:t.x,y:t.y},e("#cb-area-width").val(e.cbuilder.areapos.w),e("#cb-area-height").val(e.cbuilder.areapos.h),e("#cb-area-marginleft").val(e.cbuilder.areapos.x),e("#cb-area-margintop").val(e.cbuilder.areapos.y)},allowSelect:!1},function(){if(jcrop_api=this,"edit"===a){var t=e.cbuilder.propertiesWindow.$selectedobj,i=t.position().left,o=t.position().top,r=t.width()+6,n=t.height()+6;t.addClass("imgpos-active"),jcrop_api.setSelect([i,o,i+r,o+n])}else jcrop_api.animateTo([100,100,0,0]),e.cbuilder.areapos={w:100,h:100,x:0,y:0}})}},judge:{isJquery:function(e){return"undefined"!=typeof e&&e instanceof jQuery?!0:!1}}},p=function(t,a){this.options=e.extend({},i,a),this.$element=e(t),this.strucView()};e.cbuilder={path:{root:a,js:t},append:function(t){if(""!==t){var a='<div class="cb-item"><div class="cb-content">'+t+"</div></div>";e.cbuilder.active.$element.find(r).append(a),e.cbuilder.active._trigger("cbuilder:onWrapContent"),e.cbuilder.active._trigger("cbuilder:onContentReady")}},item:{tools:{addbtn:function(t){var a="<a href='javascript:;'>"+t.text+"</a>",i=this.element.parents(c).find(".btn-wrap");i.append(a),t.click&&i.find("a:last").on("click",function(){t.click(e(this))})}}},getContent:function(){e.cbuilder.active._trigger("cbuilder:onGetContentBefore");var t="";return t=e.cbuilder.active._content?'<div class="'+s+'">'+e.cbuilder.active._content+"</div>":this._getItemsObject().html()},setContent:function(t){e.cbuilder.active.$element.find(".cb-body").html(t),e.cbuilder.active._trigger("cbuilder:onWrapContent"),e.cbuilder.active._trigger("cbuilder:onContentReady")},_getItemsObject:function(){var t=e.cbuilder.active.$element.clone(),a=t.find(".cb-body");return a}},p.prototype={strucView:function(){var t=this,a=t.options;t.$element.data("cbuilder",t);var i={init:function(){var e=t.$element;e.data(l,e.html()),e.html(""),e.addClass("cb-container").wrap(a.tpl.container).append(a.tpl.toolbar+a.tpl.body),e.width(a.width).height(a.height),i.$body=e.find(r)},loadVendors:function(){var e=["vendor/bootstrap/dist/css/bootstrap.min.css","vendor/bootstrap/dist/css/bootstrap-theme.css","vendor/layer/layer.js","vendor/layer/skin/layer.css","vendor/dragula.js/dist/dragula.min.js","vendor/dragula.js/dist/dragula.min.css","vendor/datetimepicker/jquery.datetimepicker.css","vendor/datetimepicker/jquery.datetimepicker.js"];d.loadFile(e)},loadToolbar:function(){for(var a=function(){return e(".jcrop-holder").length>0?(d.layer.msg("","请先保存区域"),!1):!0},i=t.options.toolbar.length,r=0;i>r;r++){var n=t.options.toolbar[r],c=e.cbuilder.path.js+"toolbar/"+n+"/main.js";e.ajax({async:!1,type:"get",url:c,success:function(){var i=init(t.$element,e.cbuilder.path.root,d);if(i.isToolbar===!1)return i.onLoaded(),!1;var r="cb-"+i.toolbar.name;if(i.toolbar.text){t.$element.find(o).append(t.options.tpl.toolbar_button.replace(/\{name\}/,i.toolbar.text).replace(/\{clsname\}/,r)),t._trigger("",i.onLoaded);var n=t.$element.find("."+r);n.on("click",function(){if(e.cbuilder.active=t,"iframe"===i.type){var o=void 0!==i.width?i.width+"px":"95%",r=void 0!==i.height?i.height+"px":"95%";if(a()){var n={type:2,title:i.toolbar.text,shadeClose:!0,shade:.3,skin:"layui-layer-rim",area:[o,r],content:e.cbuilder.path.js+"toolbar/"+i.toolbar.name+"/main.html"},c=e.extend({},n,i.options);layer.open(c)}}a()&&t._trigger("",i.toolbar.onClick)})}else"function"==typeof i.onLoaded&&i.onLoaded()}})}},appendHtml:function(){i.$body.html(t.$element.data(l)),t.$element.data(l,"")},triggerCustomEvent:function(){e(document).ready(function(){t._trigger("cbuilder:onWrapContent"),t._trigger("cbuilder:onContentReady")})},bindEvents:function(){var a=t.$element.find(r);t.$element.on("cbuilder:onWrapContent",function(i){a.children(":not("+c+")").each(function(){var a=e(this);a.wrap(t.options.tpl.body_item),e.cbuilder.active=t})}),dragula(a[0],{moves:function(e,t,a){return"item-move"===a.className}}),e(".pw-body-footer").delegate(".deleteevent","click",function(t){var a="确定删除&lt;"+e.cbuilder.propertiesWindow.$selectedobj.prop("tagName")+"&gt;?";layer.confirm(a,{icon:3},function(t){e.cbuilder.propertiesWindow.$selectedobj.parents(".cb-item").remove(),e.cbuilder.propertiesWindow.hide(),layer.close(t)})}),t.$element.delegate(".cb-content","mouseover",function(t){e(this).addClass("cb-hover")}),t.$element.delegate(".cb-content","mouseout",function(t){e(this).removeClass("cb-hover")})},struc:function(){d.objectCallFunction(i,"init","loadVendors","loadToolbar","appendHtml","bindEvents","triggerCustomEvent")}};i.struc()},_trigger:function(e,t,a){this.$element.trigger(e,a||""),t&&t.call(this.$element)}};var u={itemtools:function(){var t={itemtools:'<div class="cb-itemtools"><i class="item-move" href="javascript:;"></i><i class="item-delete" href="javascript:;"></i></div>'},a={domCache:function(){var i=e("body");i.append(t.itemtools),e.cbuilder.$itemtools=a.$itemtools=i.find(".cb-itemtools"),a.$contianer=e(".cb-container"),a.$itemdelete=e(".item-delete")},mouseOverEvent:function(){a.$contianer.mouseover(function(a){var i=e(a.target),o=i.parents(n);0===e(".cb-itemtools").length&&e("body").append(t.itemtools),0===e(".jcrop-holder").length&&(o.length>0&&(o.append(e.cbuilder.$itemtools),e.cbuilder.$itemtools.show()),i.hasClass("cb-content")&&(i.append(e.cbuilder.$itemtools),e.cbuilder.$itemtools.show()))}),a.$contianer.mouseout(function(t){var a=e(t.target),i=a.parents(n);0===i.length&&e.cbuilder.$itemtools.hide()})},deleteBtnEvent:function(){a.$contianer.delegate(".item-delete","click",function(){var t=e(this);layer.confirm("确定删除该项?",{icon:3},function(e){layer.close(e),t.parents(n).detach()})})},bindEvents:function(){a.mouseOverEvent(),a.deleteBtnEvent()},struc:function(){e(document).ready(function(){a.domCache(),a.bindEvents()})}};a.struc()},propertiesWindow:function(){var t={propertiesWindow:'<!-- 标题面板 --><div id="cb-title-panel"><div class="pw-header"></div><h3 class="cb-pills-title"></h3><hr class="cb-article-divider"></div><div class="cb-propertiesWindow"><div class="cb-pw-openner" id="pwopenner">&#x5C5E;<br>&#x6027;<br>&#x83DC;<br>&#x5355;<br></div><!-- 图片 --><div class="pw-picture pw-panel" id="pwpicture"><div class="pw-body"><div class="pw-body-content"><form class="form-horizontal"><h6 class="pw-body-content-header">&#x5C5E;&#x6027;</h6><div class="form-group"><label for="cb-picture-height" class="col-sm-2 control-label">height:</label><div class="col-sm-10"><input type="text" class="form-control input-sm" id="cb-picture-height" placeholder="height"></div></div><div class="form-group"><label for="cb-picture-width" class="col-sm-2 control-label">width:</label><div class="col-sm-10"><input type="text" class="form-control input-sm" id="cb-picture-width" placeholder="width"></div></div><h6 class="pw-body-content-header">&#x663E;&#x793A;&#x65F6;&#x95F4;</h6><div class="form-group"><label for="cb-picture-showdate" class="col-sm-2 control-label">&#x5F00;&#x59CB;:</label><div class="col-sm-10"><input type="text" class="form-control input-sm" id="cb-picture-showdate" placeholder="&#x5F00;&#x59CB;"></div></div><div class="form-group"><label for="cb-picture-hidedate" class="col-sm-2 control-label">&#x7ED3;&#x675F;:</label><div class="col-sm-10"><input type="text" class="form-control input-sm" id="cb-picture-hidedate" placeholder="&#x7ED3;&#x675F;"></div></div></form><hr class="cb-article-divider"></div><div class="pw-body-footer"><button type="button" class="btn btn-primary btn-sm save">&#x4FDD; &#x5B58;</button><button type="button" class="btn btn-danger btn-sm delete">&#x5220; &#x9664;</button><button type="button" id="cb-picture-addarea" class="btn btn-primary btn-sm">&#x65B0; &#x5EFA; &#x533A; &#x57DF;</button></div></div></div><!-- 区域 --><div class="pw-area pw-panel" id="pwarea"><div class="pw-body"><div class="pw-body-content"><h6 class="pw-body-content-header">&#x4F4D;&#x7F6E;</h6><form class="form-horizontal"><div class="form-group"><label for="cb-area-width" class="col-sm-2 control-label">width:</label><div class="col-sm-10"><input type="text" class="form-control cb-area-croppos input-sm" id="cb-area-width" data-name="width" maxlength="4" placeholder="width"></div></div><div class="form-group"><label for="cb-area-height" class="col-sm-2 control-label">height:</label><div class="col-sm-10"><input type="text" class="form-control cb-area-croppos input-sm" id="cb-area-height" data-name="height" maxlength="4" placeholder="height"></div></div><div class="form-group"><label for="cb-area-marginleft" class="col-sm-3 control-label">marginleft:</label><div class="col-sm-9"><input type="text" class="form-control cb-area-croppos input-sm" id="cb-area-marginleft" data-name="left" maxlength="4" placeholder="marginleft"></div></div><div class="form-group"><label for="cb-area-margintop" class="col-sm-3 control-label">margintop:</label><div class="col-sm-9"><input type="text" class="form-control cb-area-croppos input-sm" id="cb-area-margintop" data-name="top" maxlength="4" placeholder="margintop"></div></div><hr class="cb-article-divider"><h6 class="pw-body-content-header">&#x7C7B;&#x578B;</h6><div class="pw-body-content-controls"><div id="cb-area-type"><label for="cb-area-type1"><input id="cb-area-type1" data-type="link" type="radio" name="areatype">&#x94FE;&#x63A5;</label><label for="cb-area-type2"><input id="cb-area-type2" data-type="anchor" type="radio" name="areatype">&#x951A;&#x70B9;</label><label for="cb-area-type3"><input id="cb-area-type3" data-type="countdown" type="radio" name="areatype">&#x5012;&#x8BA1;&#x65F6;</label><label for="cb-area-type4"><input id="cb-area-type4" data-type="coupon" type="radio" name="areatype">&#x4F18;&#x60E0;&#x5238;</label></div></div><div class="cb-area-type cb-area-type1 pw-controls-panel"><div class="form-group"><label for="cb-area-url" class="col-sm-3 control-label">&#x94FE;&#x63A5;&#x5730;&#x5740;:</label><div class="col-sm-9"><textarea type="text" class="form-control" rows="3" id="cb-area-url" placeholder="&#x94FE;&#x63A5;&#x5730;&#x5740;"></textarea></div></div><div class="form-group"><label for="cb-area-margintop" class="col-sm-3 control-label">&#x6253;&#x5F00;&#x65B9;&#x5F0F;:</label><div class="col-sm-9"><label for="open-type1" class="radio-inline"><input id="open-type1" data-value="_blank" type="radio" name="opentype" checked="checked">&#x65B0;&#x5EFA;&#x7A97;&#x53E3;</label><label for="open-type2" class="radio-inline"><input id="open-type2" data-value="_self" type="radio" name="opentype">&#x5F53;&#x524D;&#x7A97;&#x53E3;</label></div></div></div><div class="cb-area-type cb-area-type2 pw-controls-panel"><select id="cb-area-anchor" class="form-control input-sm"></select></div><div class="cb-area-type cb-area-type3 pw-controls-panel"><div id="cb-area-fontdemo" class="cb-temp cb-area-fontdemo"></div><div class="form-group"><label for="cb-area-margintop" class="col-sm-3 control-label">&#x5B57;&#x4F53;:</label><div class="col-sm-9"><select id="cb-area-fontfamily" class="form-control input-sm"><option value="&#x5B8B;&#x4F53;">&#x5B8B;&#x4F53;</option><option value="&#x6977;&#x4F53;">&#x6977;&#x4F53;</option><option value="&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;">&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;</option></select></div></div><div class="form-group"><label for="cb-area-fontsize" class="col-sm-3 control-label">&#x5B57;&#x4F53;&#x5927;&#x5C0F;:</label><div class="col-sm-9"><select id="cb-area-fontsize" class="form-control input-sm"></select></div></div><div class="form-group"><label for="cb-area-fontcolor" class="col-sm-3 control-label">&#x5B57;&#x4F53;&#x989C;&#x8272;:</label><div class="col-sm-9"><input type="text" class="form-control input-sm" id="cb-area-fontcolor" placeholder="&#x5B57;&#x4F53;&#x989C;&#x8272;"></div></div><div class="form-group"><label for="cb-area-startdate" class="col-sm-3 control-label">&#x5F00;&#x59CB;&#x65F6;&#x95F4;:</label><div class="col-sm-9"><input type="text" class="form-control input-sm" id="cb-area-startdate" placeholder="&#x5F00;&#x59CB;&#x65F6;&#x95F4;"></div></div><div class="form-group"><label for="cb-area-enddate" class="col-sm-3 control-label">&#x7ED3;&#x675F;&#x65F6;&#x95F4;:</label><div class="col-sm-9"><input type="text" class="form-control input-sm" id="cb-area-enddate" placeholder="&#x7ED3;&#x675F;&#x65F6;&#x95F4;"></div></div><div class="form-group"><label for="cb-area-isdayunit" class="col-sm-3 control-label">&#x5929;&#x4E3A;&#x5355;&#x4F4D;:</label><div class="col-sm-9"><div class="checkbox"><label><input type="checkbox" id="cb-area-isdayunit"></label></div></div></div><div class="form-group"><label for="cb-area-enddate" class="col-sm-3 control-label">&#x65F6;&#x95F4;&#x683C;&#x5F0F;:</label><div class="col-sm-9"><select id="cb-area-format" class="form-control input-sm"><option value="cn">&#x65F6;:&#x5206;:&#x79D2;</option><option value="HH:mm:ss">HH:mm:ss</option></select></div></div></div><div class="cb-area-type cb-area-type4 pw-controls-panel"><div class="form-group"><label for="cb-area-url" class="col-sm-3 control-label">&#x4F18;&#x60E0;&#x5238;id</label><div class="col-sm-9"><input type="text" class="form-control input-sm" id="cb-area-couponid" placeholder="&#x4F18;&#x60E0;&#x5238;id,&#x53F7;&#x5206;&#x5272;"></div></div></div></form></div><hr class="cb-article-divider"><div class="pw-body-footer"><div class="pw-body-footer"><button type="button" id="cb-area-save" class="btn btn-primary btn-sm">&#x4FDD; &#x5B58;</button><button type="button" id="cb-area-delete" class="btn btn-danger btn-sm delete">&#x5220; &#x9664;</button></div></div></div></div><!-- 锚点 --><div class="pw-picture pw-panel" id="pwanchor"><div class="pw-body"><div class="pw-body-content"><form class="form-horizontal"><div class="form-group"><label for="cb-anchor-name" class="col-sm-2 control-label">&#x540D;&#x79F0;:</label><div class="col-sm-10"><input type="text" class="form-control input-sm" id="cb-anchor-name" placeholder="&#x540D;&#x79F0;:"></div></div></form></div><hr class="cb-article-divider"><div class="pw-body-footer"><button type="button" id="cb-anchor-save" class="btn btn-primary btn-sm save">&#x4FDD; &#x5B58;</button><button type="button" id="cb-anchor-delete" class="btn btn-danger btn-sm delete deleteevent">&#x5220; &#x9664;</button></div></div></div><!-- 轮播 --><div class="pw-panel" id="pwunslider"><button type="button" id="cb-unslider-picker" class="btn btn-primary">&#x9009;&#x62E9;&#x56FE;&#x7247;</button></div><!-- 轮播 --><div class="pw-panel" id="pwSuperSlide"><button type="button" id="cb-superslide-picker" class="btn btn-primary">&#x9009;&#x62E9;&#x56FE;&#x7247;</button></div></div>',bodycontentheader:'<h1 class="pw-body-content-header">#value</h1>',hr:'<hr class="cb-article-divider">'};e("body").append(t.propertiesWindow),e("#pwopenner").on("click",function(){var t=e.cbuilder.propertiesWindow.$self.css("right");"0px"!==t||"-330px"===t?e.cbuilder.propertiesWindow.show():(e.cbuilder.propertiesWindow.$temp.hide(),e.cbuilder.propertiesWindow.$self.css({right:"-330px"}))}),e.cbuilder.propertiesWindow={$self:e("body").find(".cb-propertiesWindow"),$panel:e("body").find(".cb-propertiesWindow").find(".pw-panel"),$titlepanel:e("#cb-title-panel"),$temp:e("body").find(".cb-temp"),$selectedobj:"",$currentpw:"",show:function(t){e.cbuilder.$itemtools.hide();var a=e("#tempanchor");a&&a.removeAttr("id"),this.$temp.show(),void 0!==t?(this.$currentpw=e("#"+t.name),this.$self.find(".pw-panel").hide(),this.$titlepanel.find(".pw-header").text("<"+this.$selectedobj.prop("tagName")+">"),this.$titlepanel.find(".cb-pills-title").text(t.pillstitle),this.$currentpw.prepend(this.$titlepanel),this.$currentpw.show(),this.$self.css({right:"0px"}),this.$currentpw.trigger("propertiesWindow:Showing")):this.$self.css({right:"0px"})},hide:function(){e.cbuilder.propertiesWindow.$self.css({right:"-385px"}),this.$temp.hide()}},function(){var t={_domCache:function(){var a="cb-picture-addarea,cb-picture-height,cb-picture-width,cb-picture-showdate,cb-picture-hidedate";t.$pw=e("#pwpicture"),t.$savebtn=t.$pw.find(".pw-body-footer .save"),t.$deletebtn=t.$pw.find(".pw-body-footer .delete"),d.setObjVariable(t,a,"cb-picture-")},_addAreaBtnEvent:function(){t.$addarea.on("click",function(){d.jcrop.load(e.cbuilder.propertiesWindow.$selectedobj,"create"),e.cbuilder.propertiesWindow.show({name:"pwarea",pillstitle:"新建区域"})})},_saveBtnEvent:function(){t.$savebtn.on("click",function(){var a=e.cbuilder.propertiesWindow.$selectedobj;if(!d.regex.number.test(t.$height.val()))return d.layer.msg("","请输入正确的数字",t.$height),!1;if(a.css("height",t.$height.val()),!d.regex.number.test(t.$width.val()))return d.layer.msg("","请输入正确的数字",t.$width),!1;a.css("width",t.$width.val());var i=a.parents(".cb-cropwrap"),o=t.$showdate.val();""!==o?i.attr("showdate",o):i.removeAttr("showdate");var r=t.$hidedate.val();""!==r?i.attr("hidedate",r):i.removeAttr("hidedate"),d.layer.msg("success"),e.cbuilder.propertiesWindow.hide()})},_deleteBtnEvent:function(){t.$deletebtn.on("click",function(){var t=e.cbuilder.propertiesWindow.$selectedobj,a="确定删除&lt;"+t.prop("tagName")+"&gt;?";layer.confirm(a,{icon:3},function(a){var i="",o=t.parent(".cb-cropwrap");if(0!==o.length)i=1===o.children().length||"IMG"===t.prop("tagName")?o.parents(".cb-item"):t;else{var r=t.parents(".cb-content"),n=t.parents(".cb-item");i=1===r.children().length?n:n}i.detach(),e.cbuilder.propertiesWindow.hide(),layer.close(a)})})},_showingEvent:function(){t.$pw.on("propertiesWindow:Showing",function(a){d.removeImpos();var i=e.cbuilder.propertiesWindow.$selectedobj;t.$height.val(i.css("height").replace(/px/,"")),t.$width.val(i.css("width").replace(/px/,""));var o=i.parents(".cb-cropwrap"),r={showdate:"",hidedate:""};t.$showdate.val(o.attr("showdate")||r.showdate),t.$hidedate.val(o.attr("hidedate")||r.hidedate)})},_dateTimeEvent:function(){e(document).ready(function(){t.$showdate.datetimepicker({lang:"ch",format:"Y-m-d H:i",onShow:function(e){var a=d.dateTimePicker.format(t.$hidedate.val());a&&(a=d.dateTimePicker.reduceOneDay(a)),this.setOptions({maxDate:a})}}),t.$hidedate.datetimepicker({lang:"ch",format:"Y-m-d H:i",onShow:function(e){this.setOptions({minDate:d.dateTimePicker.format(t.$showdate.val())})}})})},_bindEvents:function(){d.objectCallFunction(t,"_showingEvent","_saveBtnEvent","_addAreaBtnEvent","_deleteBtnEvent","_dateTimeEvent")},_init:function(){var e=["vendor/spectrum/spectrum.js","vendor/spectrum/spectrum.css"];d.loadFile(e)},_struc:function(){d.objectCallFunction(t,"_init","_domCache","_bindEvents")}};t._struc()}(),function(){var t={_typeEvent:function(){t.$type.delegate("input","click",function(){var a=e(this),i=a.attr("id"),o=t.selecteType=a.data("type"),r=t.$pw.find(".pw-controls-panel"),c=e.cbuilder.propertiesWindow.$selectedobj,l="",s={};switch(r.hide(),o){case"link":s={url:"",opentype:"_blank"},t.$url.val(c.attr("href")||s.url),e.cbuilder.active.$element.find('input[name="opentype"][data-value="'+(c.attr("target")||s.opentype)+'"]').trigger("click");break;case"anchor":var d=e.cbuilder.active.$element.find(n).find(".cb-anchor"),p=t.$anchor;0===d.length?p.html("<option>没有锚点</option>"):(d.each(function(){var t=e(this).attr("id");l+="<option value="+t+">"+t+"</option>"}),p.html(l),c.attr("href")&&p.find("option[value='"+c.attr("href").replace(/#/,"")+"']").prop("selected","selected"));break;case"countdown":for(var u=14;40>u;u+=2)l+='<option value="'+u+'">'+u+"px</option>";if(t.$fontsize.html(l),null!==c.prop("style").cssText.toString().match(/font-size/)){var b=c.css("font-size");t.$fontsize.find("option[value="+b.replace(/px/,"")+"]").prop("selected","selected"),t.$fontdemo.css("font-size",b)}if(t.$fontsize.trigger("change"),s={color:"#000",startdate:"",enddate:"",isdayunit:"true",format:"cn"},t.$startdate.val(c.attr("startdate")||s.startdate),t.$enddate.val(c.attr("enddate")||s.enddate),null!==c.prop("style").cssText.toString().match(/font-family/)){var m=c.css("font-family");t.$fontfamily.find('option[value="'+m+'"]').prop("selected","selected"),t.$fontdemo.css("font-family",m)}t.$fontcolor.spectrum({showPalette:!0,color:c.css("color")||s.color,showInput:!0,preferredFormat:"hex",hideAfterPaletteSelect:!0,clickoutFiresChange:!0,showButtons:!0,chooseText:"选择",cancelText:"取消",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(e){t.$fontdemo.css("color",e.toHexString())}});var f=!1;f="undefined"==typeof c.attr("isdayunit")?!0:"true"===c.attr("isdayunit")?!0:"",t.$isdayunit.prop("checked",f),t.$isdayunit.trigger("change"),t.$format.val(c.attr("format")||s.format);break;case"coupon":t.$couponid.val(c.attr("data-id")||"")}t.$pw.find(".pw-controls-panel[class*="+i+"]").show()})},_cropPosInputEvent:function(){t.$croppos.on("keypress",function(e){isNaN(String.fromCharCode(e.which))&&e.preventDefault()}),t.$croppos.on("keyup",function(a){var i=a.keyCode;32===i?a.returnValue=!1:i>=48&&57>=i||i>=96&&105>=i||8===i||46===i?(a.returnValue=!0,setTimeout(function(){var i=parseInt(t.$width.val()),o=parseInt(t.$height.val()),r=parseInt(t.$marginleft.val()),n=parseInt(t.$margintop.val()),c=e(a.target),l=c.data("name"),s=parseInt(a.target.value)||0;"width"===l&&(i=s),"height"===l&&(o=s),"left"===l&&(r=s),"top"===l&&(n=s),"undefined"!=typeof jcrop_api&&(jcrop_api.animateTo([i+r,o+n,r,n]),e.cbuilder.areapos={w:i,h:o,x:r,y:n})},200)):a.returnValue=!1})},_showingEvent:function(){t.$pw.on("propertiesWindow:Showing",function(){t.$width.val(e.cbuilder.areapos.w),t.$height.val(e.cbuilder.areapos.h),t.$marginleft.val(e.cbuilder.areapos.x),t.$margintop.val(e.cbuilder.areapos.y),t.$pw.trigger("propertiesWindow:areaTypeShow")}),t.$pw.on("propertiesWindow:areaTypeShow",function(){var a=e.cbuilder.propertiesWindow.$selectedobj,i=a.attr("linktype");i?t.$type.find("input[data-type="+i+"]").trigger("click"):t.$type.find("input:eq(0)").trigger("click")}),t.$pw.on("propertiesWindow:areaTypeSave",function(){var a,i=t.selecteType,o="",r="a";switch(i){case"link":var c=e.trim(t.$url.val()).toString(),l=e('input[name="opentype"]:checked').data("value");if(!c.match(d.regex.url))return d.layer.msg("","请输入正确的链接地址",t.$url),!1;o+='target="'+l+'"',o+='href="'+c+'"';break;case"anchor":var s=e.cbuilder.active.$element.find(n).find(".cb-anchor");if(0===s.length)return d.layer.msg("","请添加锚点",s),!1;o+='href="#'+t.$anchor.val()+'"';break;case"countdown":if(r="div",t.startdate=t.$startdate.val(),t.enddate=t.$enddate.val(),t.format=t.$format.val(),t.isdayunit=t.$isdayunit.prop("checked"),""===t.startdate)return d.layer.msg("","请选择开始时间",t.$startdate),!1;if(""===t.enddate)return d.layer.msg("","请选择结束时间",t.$enddate),!1;a=function(e){e.css("font-family",t.$fontfamily.val()),e.css("font-size",t.$fontsize.val()+"px"),e.css("color",t.$fontcolor.spectrum("get").toHexString()),e.attr("startdate",t.startdate),e.attr("enddate",t.enddate),e.attr("isdayunit",t.isdayunit),e.attr("format",t.format)};break;case"coupon":var p=t.$couponid.val();if(""===p)return d.layer.msg("","请输入优惠券id",t.$couponid),!1;if(p.indexOf(",")>=0||!d.regex.number.test(p)){var u=/^(\d+\,)+\d+$/;if(!u.test(p))return d.layer.msg("","优惠券id格式不正确,格式[数字,数字] 如:123,456",t.$couponid),!1}a=function(e){e.attr("data-id",p)}}o+=' linktype="'+i+'"';var b=e.cbuilder.areapos.w-6,m=e.cbuilder.areapos.h-6,f=e.cbuilder.areapos.x,v=e.cbuilder.areapos.y,h="left:"+f+"px;top:"+v+"px;width:"+b+"px;height:"+m+"px;",g="<"+r+' class="imgpos" id="tempimgpos" style="'+h+'"  '+o+" ></"+r+">",y=e.cbuilder.propertiesWindow.$selectedobj.parent();if(y.append(g),"function"==typeof a){var x=e("#tempimgpos");a(x)}d.removeImpos(),d.layer.msg("success"),e.cbuilder.propertiesWindow.hide()})},_deleteBtnEvent:function(){t.$delete.on("click",function(){layer.confirm("确定删除<当前区域>?",{icon:3},function(t){d.removeImpos(),e.cbuilder.propertiesWindow.hide(),layer.close(t)})})},_saveBtnEvent:function(){t.$save.on("click",function(){"undefined"!=typeof jcrop_api&&t.$pw.trigger("propertiesWindow:areaTypeSave")})},_countDownEvent:function(){t.$fontfamily.change(function(){t.$fontdemo.css("font-family",e(this).val())}),t.$fontsize.change(function(){t.$fontdemo.css("font-size",e(this).val()+"px"),t.$fontdemo.css("line-height",e(this).val()+"px")});var a=function(){var e=t.$isdayunit.prop("checked"),a=t.$format.val(),i="25HH01mm01ss";"cn"===a?i=i.replace(/HH/g,"时").replace(/mm/g,"分").replace(/ss/g,"秒"):"HH:mm:ss"===a&&(i=i.replace(/HH/g,":").replace(/mm/g,":").replace(/ss/g,"")),e&&(i=i.replace(/25HH/g,"1天01时").replace(/25时/g,"1天01时").replace(/25:/g,"1天 01:")),t.$fontdemo.text(i)};t.$isdayunit.change(function(){a()}),t.$format.change(function(){a()})},_dateTimeEvent:function(){e(document).ready(function(){t.$startdate.datetimepicker({lang:"ch",format:"Y-m-d H:i",onShow:function(e){var a=d.dateTimePicker.format(t.$enddate.val());a&&(a=d.dateTimePicker.reduceOneDay(a)),this.setOptions({maxDate:a})}}),t.$enddate.datetimepicker({lang:"ch",format:"Y-m-d H:i",onShow:function(e){this.setOptions({minDate:d.dateTimePicker.format(t.$startdate.val())})}})})},_bindEvents:function(){d.objectCallFunction(t,"_cropPosInputEvent","_saveBtnEvent","_deleteBtnEvent","_typeEvent","_countDownEvent","_dateTimeEvent")},_domCache:function(){var a="cb-area-couponid,cb-area-format,cb-area-type,cb-area-url,.cb-area-croppos,cb-area-width,cb-area-height,cb-area-marginleft,cb-area-margintop,cb-area-anchor,pw-area",i=",cb-area-save,cb-area-delete",o=",cb-area-fontfamily,cb-area-fontsize,cb-area-fontdemo,cb-area-fontcolor,cb-area-startdate,cb-area-enddate,cb-area-isdayunit";a+=i+o,d.setObjVariable(t,a,"cb-area-"),t.$pw=e("#pwarea")},_struc:function(){d.objectCallFunction(t,"_domCache","_showingEvent","_bindEvents")}};t._struc()}(),function(){var t={_domCache:function(){var e="cb-unslider-picker";d.setObjVariable(t,e,"cb-unslider-")},_build:function(){console.log(t),t.$picker.bind("click",function(){var t=e("#Picker");t.length||(t=e('<div class="modal fade" id="Picker"></div>'),e(document.body).append(t)),console.log(t),t=t.picker("multi_picture",{title:"多图片选择",confirm_text:"确定",cancel_text:"取消",folder_method:"post",folder_url:"/service/image/getFolder",image_method:"post",image_url:"/service/image/getImages",rows:8,onComplete:function(a){var i=e.cbuilder.propertiesWindow.$selectedobj,o=e("<ul></ul>");i.html("").append(o);for(var r=0,n=a.length;n>r;r++)o.append('<li><img src="'+a[r].src+'" /></li>');i.unslider({speed:500,delay:3e3,arrows:!1,fluid:!0,dots:!0}),t.modal("hide")}}),t.modal("show")})},_struc:function(){d.objectCallFunction(t,"_domCache","_build")}};t._struc()}(),function(){var t={_domCache:function(){var e="cb-superslide-picker";d.setObjVariable(t,e,"cb-superslide-")},_build:function(){t.$picker.bind("click",function(){var t=e("#Picker");t.length||(t=e('<div class="modal fade" id="Picker"></div>'),e(document.body).append(t)),t=t.picker("multi_picture",{title:"多图片选择",confirm_text:"确定",cancel_text:"取消",folder_method:"post",folder_url:"/service/image/getFolder",image_method:"post",image_url:"/service/image/getImages",rows:8,onComplete:function(a){var i=e.cbuilder.propertiesWindow.$selectedobj,o=e('<div class="bd"></div>'),r=e("<ul></ul>");o.append(r);for(var n=0,c=a.length;c>n;n++)r.append('<li><a href="#" target="_blank"><img src="'+a[n].src+'" /></a></li>');i.html("").append(o),i.append('<a class="prev" href="javascript:void(0)"></a>'),i.append('<a class="next" href="javascript:void(0)"></a>'),i.slide({mainCell:".bd ul",effect:"left",autoPlay:!0,mouseOverStop:!0}),t.modal("hide")}}),t.modal("show")})},_struc:function(){d.objectCallFunction(t,"_domCache","_build")}};t._struc()}()},struc:function(){e(document).ready(function(){d.objectCallFunction(u,"propertiesWindow","itemtools")})}};u.struc(),e.fn.cbuilder=function(t){var a=arguments;return e(this).each(function(){var i=e(this).data(s),o="object"!=typeof t?null:t;i||(i=new p(this,o),e(this).data(s,i)),"string"==typeof t&&i[t].apply(i,Array.prototype.slice.call(a,1))})}});