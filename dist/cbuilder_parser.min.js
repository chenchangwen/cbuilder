function stringToDate(t){if(t&&t.indexOf("-")>=4&&t.indexOf(":")>=13){var a=t.split(" ")[0].split("-"),n=t.split(" ")[1].split(":");return new Date(a[0],a[1]-1,a[2],null!==n[0]?n[0]:0,null!==n[1]?n[1]:0,null!==n[2]?n[2]:0)}return/^\d+$/.test(t)?(10===t.length&&(t+="000"),new Date(parseInt(t,10))):void 0}var goodIdAry=[],showGoodIdAry=[],patterns=[/goods_id=\d+/,/\d+.html/gi,/goods-\d+/],$imgpos,$cropwrap,$cropwraptab,isshow=!1,serverTime,cbuilder={cropWrapEvent:function(){$cropwrap.each(function(){var t=1e3*serverTime,a=$(this),n=stringToDate(a.attr("showdate")),e=stringToDate(a.attr("hidedate"));void 0===n&&void 0===e?isshow=!0:(void 0!=n&&void 0===e&&new Date(n)<t&&(isshow=!0),void 0!=e&&void 0===n&&t<new Date(e)&&(isshow=!0),void 0!=n&&void 0!=e&&(isshow=new Date(n)<t&&t<new Date(e))),isshow?a.find("img").show():(a.hide(),a.find("img").hide()),cbuilder.countdownEvent(a)})},tabContainerEvent:function(){$(".tabcontainer").each(function(){var t=$(this),a=$('div[tabcontainer="'+t.attr("id")+'"][tabname]');t.append(a)})},imgPosEvent:function(){$imgpos.each(function(t){var a=$(this);"A"===a[0].tagName||"countdown"===a.attr("linktype")||"tab"===a.attr("linktype")?a.css("display","block!important"):a.css("display","none");var n=a.attr("href");if(n&&n.indexOf("item.shenba.com")>=0){for(var e=0;e<patterns.length;e++)patterns[e].test(n)&&(n=n.toString(),n=n.match(patterns[e]));null!=n&&(n=n.toString().match(/\d+/),void 0==a.attr("linkicon")&&null!=n&&goodIdAry.push(n))}t===$imgpos.length-1&&cbuilder.showGoodPicTip()})},trnpicEvent:function(){$(".cropwrap img").each(function(){var t=$(this);if(void 0!=t.attr("trnpic")){var a=t.attr("trnpic").split(","),n=t.attr("trndate").split(",");if(""!==n){t.hide();for(var e=1e3*serverTime,i=new Date(e),o=i.getHours(),r=0;r<a.length;r++)parseInt(n[r])===o&&t.attr("src")!==a[r]&&t.attr("src",a[r]);t.show()}}})},countdownEvent:function(t){function a(){var r=1e3*e.data("time"),l=(d.parent().data("cdsuffix"),"");i=e.data("startdate"),o=e.data("enddate"),i>r&&o>r||i>r&&void 0==o?(l="距离开始时间还有: ",n=i-r):(void 0==i&&o>=r||o>=r)&&(l="距离结束时间还有: ",n=o-r);var u,f,v,h,m;if(n>=0){u=Math.floor(n/864e5),n-=864e5*u,f=Math.floor(n/36e5),n-=36e5*f,v=Math.floor(n/6e4),n-=6e4*v,h=Math.floor(n/1e3),10>f&&(f="0"+f),10>v&&(v="0"+v),10>h&&(h="0"+h),m=parseInt(f)+24*u,d.html(u>0&&m>=24?u+"天"+f:m),c.html(l+" "),s.html(v),p.html(h);var g=t.data("time")+1;t.data("time",g),t.cdtimeout=setTimeout(a,1e3)}else"undefined"!=typeof t.cdtimeout&&clearTimeout(t.cdtimeout),e.find(".imgpos[linktype='countdown']").remove()}var n,e=t,i=e.attr("startdate"),o=e.attr("enddate");e.removeAttr("dayhours"),void 0!=i&&(i=new Date(stringToDate(i))),void 0!=o&&(o=new Date(stringToDate(o))),e.data("startdate",i).data("enddate",o),e.removeAttr("startdate").removeAttr("enddate");var r=e.find(".imgpos[linktype='countdown']");r.each(function(){var t=$(this),a="",n=!1;a+="<span class='edtip'></span>","true"===t.attr("cdsuffix")?(a+="<span class='edh'></span><span>时</span>",a+="<span class='edm'></span><span>分</span>",a+="<span class='eds'></span><span>秒</span>",n=!0):(a+="<span class='edh'></span>",a+="<span class='edm'></span>",a+="<span class='eds'></span>",t.data("cdsuffix","false")),t.removeAttr("cdsuffix"),t.html(a),t.data("cdsuffix",n)}),e.data("time",serverTime);var d=e.find(".edh"),s=e.find(".edm"),c=e.find(".edtip"),p=e.find(".eds");a()},tabEvent:function(){var t=$("div[tabtarget]");t.css("display","block");var a=function(t){var a=t,n=a.attr("tabtarget"),e=$('div[tabname="'+n+'"]'),i=$("#"+e.attr("tabcontainer")),o=i.find('div[tabname="'+n+'"]');0===o.length&&i.append(e),i.find("div").hide(),e.show(),e.find("img,div").show()};t.each(function(){var t=$(this),n=t.attr("tabaction");"click"===n?t.on("click",function(){a($(this))}):"hover"===n&&t.on("mouseover",function(){a($(this))})})},showGoodPicTip:function(){if(0===goodIdAry.length)return!1;var t={url:"/index.php?act=index&op=getgoods_storage",data:{client:"pc",goods_id:goodIdAry.toString()}};cbuilder.ajaxData(t,function(t){var a=t;if(void 0!=a.data){var n=a.data;if(1===n.status&&void 0!=n.list){var e=n.list,i=0,o=0;for(i=0,o=e.length;o>i;i++)e[i].goods_storage<=0&&""!==e[i].goods_id&&showGoodIdAry.push(e[i].goods_id);for(i=0,o=showGoodIdAry.length;o>i;i++)$(".imgpos").each(function(){var t=$(this),a=t.attr("href"),n="";if(a)for(var e=0;e<patterns.length;e++)n=a.toString().match(/\d+/),n&&n[0]===showGoodIdAry[i]&&t.children("b").css("display","block")})}}})},couponEvent:function(){$('.cropwrap .imgpos[linktype="button"]').on("click",function(){var t=$(this).data("id");if(!t)return!1;var a={url:"/index.php?act=coupon&op=receiveCoupon",data:{coupon_ids:t,client:"pc"}};cbuilder.ajaxData(a,function(t){var a=t;"60004"===a.code?sbLib.loginShow(0):layer.alert(a.desc)})})},objectCallFunction:function(t){for(var a,n=1;n<arguments.length;n++)a=t[arguments[n]],"function"==typeof a&&a()},domCache:function(){$cropwrap=$(".cropwrap"),$imgpos=$cropwrap.find(".imgpos"),$cropwraptab=$(".cropwraptab"),serverTime=stringToDate($("div[data-nowtime]").data("nowtime"))/1e3||(new Date).getTime()/1e3},bindEvents:function(){cbuilder.objectCallFunction(cbuilder,"cropWrapEvent","tabContainerEvent","tabEvent","couponEvent");var t=$("#list-container img"),a=t.length,n=0;t.one("load",function(){++n===a&&cbuilder.imgPosEvent()}).each(function(){this.complete&&$(this).load()})},ajaxData:function(t,a){var n={type:"post"},e=$.extend({},n,t);$.ajax({url:e.url,data:e.data,type:e.type,success:function(t){"function"==typeof a&&a($.parseJSON(t))}})},struc:function(){$(document).ready(function(){cbuilder.objectCallFunction(cbuilder,"domCache","bindEvents")})}};cbuilder.struc();