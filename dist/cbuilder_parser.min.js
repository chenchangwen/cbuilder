var cbuilder={};!function(){var t,n=!1,a={setObjVariable:function(t,n,a){if(void 0!=n&&"string"==typeof n){n=n.split(",");for(var e=0;e<n.length;e++){var i=n[e];a&&(i=i.replace(a,""));var o="#";n[e].indexOf(".")>=0&&(i=i.replace(/\./gi,""),o=""),t["$"+i]=$(o+n[e])}}},stringToDate:function(t){if(t&&t.indexOf("-")>=4&&t.indexOf(":")>=13){var n=t.split(" ")[0].split("-"),a=t.split(" ")[1].split(":");return new Date(n[0],n[1]-1,n[2],null!==a[0]?a[0]:0,null!==a[1]?a[1]:0,null!==a[2]?a[2]:0)}return/^\d+$/.test(t)?(10===t.length&&(t+="000"),new Date(parseInt(t,10))):void 0},objectCallFunction:function(t){for(var n,a=1;a<arguments.length;a++)n=t[arguments[a]],"function"==typeof n&&n()},ajaxData:function(t,n){var a={type:"post"},e=$.extend({},a,t);$.ajax({url:e.url,data:e.data,type:e.type,success:function(t){"function"==typeof n&&n($.parseJSON(t))}})}},e={_domCache:function(){a.setObjVariable(e,".cb-cropwrap","cb-"),e.$imgpos=e.$cropwrap.find(".imgpos"),t=a.stringToDate($("div[data-nowtime]").data("nowtime"))/1e3||(new Date).getTime()/1e3},cropWrapEvent:function(){e.$cropwrap.each(function(){var i=1e3*t,o=$(this),d=a.stringToDate(o.attr("showdate")),r=a.stringToDate(o.attr("hidedate"));void 0===d&&void 0===r?n=!0:(void 0!=d&&void 0===r&&new Date(d)<i&&(n=!0),void 0!=r&&void 0===d&&i<new Date(r)&&(n=!0),void 0!=d&&void 0!=r&&(n=new Date(d)<i&&i<new Date(r))),n?o.find("img").show():(o.hide(),o.find("img").hide()),e.countdownEvent(o)})},tabContainerEvent:function(){$(".tabcontainer").each(function(){var t=$(this),n=$('div[tabcontainer="'+t.attr("id")+'"][tabname]');t.append(n)})},countdownEvent:function(n){function e(){var t=1e3*o.data("time"),a=(c.parent().data("cdsuffix"),"");d=o.data("startdate"),r=o.data("enddate"),d>t&&r>t||d>t&&void 0==r?(a="距离开始时间还有: ",i=d-t):(void 0==d&&r>=t||r>=t)&&(a="距离结束时间还有: ",i=r-t);var s,l,v,h,m;if(i>=0){s=Math.floor(i/864e5),i-=864e5*s,l=Math.floor(i/36e5),i-=36e5*l,v=Math.floor(i/6e4),i-=6e4*v,h=Math.floor(i/1e3),10>l&&(l="0"+l),10>v&&(v="0"+v),10>h&&(h="0"+h),m=parseInt(l)+24*s,c.html(s>0&&m>=24?s+"天"+l:m),p.html(a+" "),f.html(v),u.html(h);var g=n.data("time")+1;n.data("time",g),n.cdtimeout=setTimeout(e,1e3)}else"undefined"!=typeof n.cdtimeout&&clearTimeout(n.cdtimeout),o.find(".imgpos[linktype='countdown']").remove()}var i,o=n,d=o.attr("startdate"),r=o.attr("enddate");o.removeAttr("dayhours"),void 0!=d&&(d=new Date(a.stringToDate(d))),void 0!=r&&(r=new Date(a.stringToDate(r))),o.data("startdate",d).data("enddate",r),o.removeAttr("startdate").removeAttr("enddate");var s=o.find(".imgpos[linktype='countdown']");s.each(function(){var t=$(this),n="",a=!1;n+="<span class='edtip'></span>","true"===t.attr("cdsuffix")?(n+="<span class='edh'></span><span>时</span>",n+="<span class='edm'></span><span>分</span>",n+="<span class='eds'></span><span>秒</span>",a=!0):(n+="<span class='edh'></span>",n+="<span class='edm'></span>",n+="<span class='eds'></span>",t.data("cdsuffix","false")),t.removeAttr("cdsuffix"),t.html(n),t.data("cdsuffix",a)}),o.data("time",t);var c=o.find(".edh"),f=o.find(".edm"),p=o.find(".edtip"),u=o.find(".eds");e()},tabEvent:function(){var t=$("div[tabtarget]");t.css("display","block");var n=function(t){var n=t,a=n.attr("tabtarget"),e=$('div[tabname="'+a+'"]'),i=$("#"+e.attr("tabcontainer")),o=i.find('div[tabname="'+a+'"]');0===o.length&&i.append(e),i.find("div").hide(),e.show(),e.find("img,div").show()};t.each(function(){var t=$(this),a=t.attr("tabaction");"click"===a?t.on("click",function(){n($(this))}):"hover"===a&&t.on("mouseover",function(){n($(this))})})},couponEvent:function(){$('.cropwrap .imgpos[linktype="button"]').on("click",function(){var t=$(this).data("id");if(!t)return!1;var n={url:"/index.php?act=coupon&op=receiveCoupon",data:{coupon_ids:t,client:"pc"}};a.ajaxData(n,function(t){var n=t;"60004"===n.code?sbLib.loginShow(0):layer.alert(n.desc)})})},_bindEvents:function(){},_HotLinkComponent:function(){var t=[],n=[],i=[/goods_id=\d+/,/\d+.html/gi,/goods-\d+/],o={checkState:function(){e.$imgpos.each(function(n){var a=$(this),d=a.attr("href");if(d&&d.indexOf("item.shenba.com")>=0){for(var r=0;r<i.length;r++)i[r].test(d)&&(d=d.toString(),d=d.match(i[r]));null!=d&&(d=d.toString().match(/\d+/),void 0==a.attr("linkicon")&&null!=d&&t.push(d))}n===e.$imgpos.length-1&&o.showStateIcon()})},showStateIcon:function(){if(0===t.length)return!1;var e={url:"/index.php?act=index&op=getgoods_storage",data:{client:"pc",goods_id:t.toString()}};a.ajaxData(e,function(t){var a=t;if(void 0!=a.data){var e=a.data;if(1===e.status&&void 0!=e.list){var o=e.list,d=0,r=0;for(d=0,r=o.length;r>d;d++)o[d].goods_storage<=0&&""!==o[d].goods_id&&n.push(o[d].goods_id);for(d=0,r=n.length;r>d;d++)$(".imgpos").each(function(){var t=$(this),a=t.attr("href"),e="";if(a)for(var o=0;o<i.length;o++)e=a.toString().match(/\d+/),e&&e[0]===n[d]&&t.children("b").css("display","block")})}}})},checkCountDown:function(){},init:function(){o.checkState()}};o.init()},_parseComponents:function(){e._domCache(),a.objectCallFunction(e,"_domCache","_HotLinkComponent")},init:function(){var t=$("img"),n=t.length,a=0;t.one("load",function(){++a===n&&e._parseComponents()}).each(function(){this.complete&&$(this).load()})}};cbuilder={parse:function(t){t&&(cbuilder.selector=t),$(document).ready(function(){e.init()})}},cbuilder.parse()}();