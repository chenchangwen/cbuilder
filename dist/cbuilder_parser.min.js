var cbuilder={};!function(){var t,n="img",a={setObjVariable:function(t,n,a){if(void 0!=n&&"string"==typeof n){n=n.split(",");for(var e=0;e<n.length;e++){var i=n[e];a&&(i=i.replace(a,""));var o="#";n[e].indexOf(".")>=0&&(i=i.replace(/\./gi,""),o=""),t["$"+i]=$(o+n[e])}}},stringToDate:function(t){if(t&&t.indexOf("-")>=4&&t.indexOf(":")>=13){var n=t.split(" ")[0].split("-"),a=t.split(" ")[1].split(":");return new Date(n[0],n[1]-1,n[2],null!==a[0]?a[0]:0,null!==a[1]?a[1]:0,null!==a[2]?a[2]:0)}return/^\d+$/.test(t)?(10===t.length&&(t+="000"),new Date(parseInt(t,10))):void 0},objectCallFunction:function(t){for(var n,a=1;a<arguments.length;a++)n=t[arguments[a]],"function"==typeof n&&n()},ajaxData:function(t,n){var a={type:"post"},e=$.extend({},a,t);$.ajax({url:e.url,data:e.data,type:e.type,success:function(t){"function"==typeof n&&n($.parseJSON(t))}})}},e=function(t){this.element=t};e.prototype={start:function(){function n(){var t=1e3*a.data("time"),d="",c=a.data("startdate"),s=a.data("enddate"),u=a.data("isdayunit"),l=0;c>t&&s>t||c>t&&void 0==s?(d="距离开始时间还有:",l=c-t):(void 0==c&&s>=t||s>=t)&&(d="距离结束时间还有:",l=s-t);var f,p,h,v,m;if(l>=0){f=Math.floor(l/864e5),l-=864e5*f,p=Math.floor(l/36e5),l-=36e5*p,h=Math.floor(l/6e4),l-=6e4*h,v=Math.floor(l/1e3),10>p&&(p="0"+p),10>h&&(h="0"+h),10>v&&(v="0"+v),m=parseInt(p)+24*f,e.html(f>0&&"true"===u&&m>=24?f+"天"+p+"时":m+"时"),o.html(d),i.html(h+"分"),r.html(v+"秒");var g=a.data("time")+1;a.data("time",g),a.cdtimeout=setTimeout(n,1e3)}else"undefined"!=typeof a.cdtimeout&&clearTimeout(a.cdtimeout),a.remove()}this.init(),this.appendHtml();var a=this.element;a.data("time",t);var e=a.find(".cdh"),i=a.find(".cdm"),o=a.find(".cdtip"),r=a.find(".cds");n()},init:function(){var t=this.element,n=t.attr("startdate"),e=t.attr("enddate"),i=t.attr("isdayunit");void 0!=n&&(n=new Date(a.stringToDate(n))),void 0!=e&&(e=new Date(a.stringToDate(e))),t.data("startdate",n).data("enddate",e).data("isdayunit",i),t.removeAttr("startdate").removeAttr("enddate").removeAttr("isdayunit")},appendHtml:function(){var t="",n=this.element;t+="<span class='cdtip'></span>",t+="<span class='cdh'></span>",t+="<span class='cdm'></span>",t+="<span class='cds'></span>",n.html(t)}};var i={_domCache:function(){a.setObjVariable(i,".cb-cropwrap","cb-"),i.$imgpos=i.$cropwrap.find(".imgpos"),t=a.stringToDate($("div[data-nowtime]").data("nowtime"))/1e3||(new Date).getTime()/1e3},tabContainerEvent:function(){$(".tabcontainer").each(function(){var t=$(this),n=$('div[tabcontainer="'+t.attr("id")+'"][tabname]');t.append(n)})},tabEvent:function(){var t=$("div[tabtarget]");t.css("display","block");var n=function(t){var n=t,a=n.attr("tabtarget"),e=$('div[tabname="'+a+'"]'),i=$("#"+e.attr("tabcontainer")),o=i.find('div[tabname="'+a+'"]');0===o.length&&i.append(e),i.find("div").hide(),e.show(),e.find("img,div").show()};t.each(function(){var t=$(this),a=t.attr("tabaction");"click"===a?t.on("click",function(){n($(this))}):"hover"===a&&t.on("mouseover",function(){n($(this))})})},couponEvent:function(){$('.cropwrap .imgpos[linktype="button"]').on("click",function(){var t=$(this).data("id");if(!t)return!1;var n={url:"/index.php?act=coupon&op=receiveCoupon",data:{coupon_ids:t,client:"pc"}};a.ajaxData(n,function(t){var n=t;"60004"===n.code?sbLib.loginShow(0):layer.alert(n.desc)})})},_bindEvents:function(){},_HotLinkComponent:function(){var o=[],r=[],d=[/goods_id=\d+/,/\d+.html/gi,/goods-\d+/],c={checkIconState:function(){i.$imgpos.each(function(t){var n=$(this),a=n.attr("href");if(a&&a.indexOf("item.shenba.com")>=0){for(var e=0;e<d.length;e++)d[e].test(a)&&(a=a.toString(),a=a.match(d[e]));null!=a&&(a=a.toString().match(/\d+/),void 0==n.attr("linkicon")&&null!=a&&o.push(a))}t===i.$imgpos.length-1&&c.showStateIcon()})},checkCountDownState:function(){var o=!1;i.$cropwrap.each(function(){var i=1e3*t,r=$(this),d=a.stringToDate(r.attr("showdate")),c=a.stringToDate(r.attr("hidedate"));if(void 0===d&&void 0===c?o=!0:(void 0!=d&&void 0===c&&new Date(d)<i&&(o=!0),void 0!=c&&void 0===d&&i<new Date(c)&&(o=!0),void 0!=d&&void 0!=c&&(o=new Date(d)<i&&i<new Date(c))),o){r.find(n).show();var s=r.find(".imgpos[linktype='countdown']");s.each(function(){var t=new e($(this));t.start(),$(this).removeAttr("linktype")})}else r.hide(),r.find(n).hide()})},showStateIcon:function(){if(0===o.length)return!1;var t={url:"/index.php?act=index&op=getgoods_storage",data:{client:"pc",goods_id:o.toString()}};return a.ajaxData(t,function(t){var n=t;if(void 0!=n.data){var a=n.data;if(1===a.status&&void 0!=a.list){var e=a.list,i=0,o=0;for(i=0,o=e.length;o>i;i++)e[i].goods_storage<=0&&""!==e[i].goods_id&&r.push(e[i].goods_id);for(i=0,o=r.length;o>i;i++)$(".imgpos").each(function(){var t=$(this),n=t.attr("href"),a="";if(n)for(var e=0;e<d.length;e++)a=n.toString().match(/\d+/),a&&a[0]===r[i]&&t.children("b").css("display","block")})}}}),!1},init:function(){a.objectCallFunction(c,"checkIconState","checkCountDownState")}};c.init()},_ComponentsCustomEvent:function(){},_parseComponents:function(){a.objectCallFunction(i,"_domCache","_HotLinkComponent")},init:function(){var t=$("img"),n=t.length,a=0;t.one("load",function(){++a===n&&i._parseComponents()}).each(function(){this.complete&&$(this).load()})}};cbuilder={parse:function(t){t&&(cbuilder.selector=t),$(document).ready(function(){i.init()})}},cbuilder.parse()}();