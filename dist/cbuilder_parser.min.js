var cbuilder={};!function(){var t,n="img",e={setObjVariable:function(t,n,e){if(void 0!=n&&"string"==typeof n){n=n.split(",");for(var a=0;a<n.length;a++){var i=n[a];e&&(i=i.replace(e,""));var o="#";n[a].indexOf(".")>=0&&(i=i.replace(/\./gi,""),o=""),t["$"+i]=$(o+n[a])}}},stringToDate:function(t){if(t&&t.indexOf("-")>=4&&t.indexOf(":")>=13){var n=t.split(" ")[0].split("-"),e=t.split(" ")[1].split(":");return new Date(n[0],n[1]-1,n[2],null!==e[0]?e[0]:0,null!==e[1]?e[1]:0,null!==e[2]?e[2]:0)}return/^\d+$/.test(t)?(10===t.length&&(t+="000"),new Date(parseInt(t,10))):void 0},objectCallFunction:function(t){for(var n,e=1;e<arguments.length;e++)n=t[arguments[e]],"function"==typeof n&&n()},ajaxData:function(t,n){var e={type:"post"},a=$.extend({},e,t);$.ajax({url:a.url,data:a.data,type:a.type,success:function(t){"function"==typeof n&&n($.parseJSON(t))}})}},a=function(t){this.element=t};a.prototype={start:function(){function n(){var t=1e3*e.data("time"),c="",d=e.startdate,s=e.enddate,l=e.isdayunit,u=0;d>t&&s>t||d>t&&void 0==s?(c="距离开始时间还有:",u=d-t):(void 0==d&&s>=t||s>=t)&&(c="距离结束时间还有:",u=s-t);var f,p,h,v,m;if(u>=0){f=Math.floor(u/864e5),u-=864e5*f,p=Math.floor(u/36e5),u-=36e5*p,h=Math.floor(u/6e4),u-=6e4*h,v=Math.floor(u/1e3),10>p&&(p="0"+p),10>h&&(h="0"+h),10>v&&(v="0"+v),m=parseInt(p)+24*f,"cn"===e.format?(a.html(f>0&&"true"===l&&m>=24?f+"天"+p+"时":m+"时"),o.html(c),i.html(h+"分"),r.html(v+"秒")):"HH:mm:ss"===e.format&&(a.html(f>0&&"true"===l&&m>=24?f+"天"+p+":":m+":"),o.html(c),i.html(h+":"),r.html(v));var g=e.data("time")+1;e.data("time",g),e.cdtimeout=setTimeout(n,1e3)}else"undefined"!=typeof e.cdtimeout&&clearTimeout(e.cdtimeout),e.remove()}this.init(),this.appendHtml();var e=this.element;e.data("time",t);var a=e.find(".cdh"),i=e.find(".cdm"),o=e.find(".cdtip"),r=e.find(".cds");n()},init:function(){var t=this.element,n=t.attr("startdate"),a=t.attr("enddate");void 0!=n&&(n=new Date(e.stringToDate(n+":00"))),void 0!=a&&(a=new Date(e.stringToDate(a+":00"))),t.format=t.attr("format")||"cn",t.startdate=n,t.enddate=a,t.isdayunit=t.attr("isdayunit"),t.removeAttr("startdate").removeAttr("enddate").removeAttr("isdayunit").removeAttr("format")},appendHtml:function(){var t="",n=this.element;t+="<span class='cdtip'></span>",t+="<span class='cdh'></span>",t+="<span class='cdm'></span>",t+="<span class='cds'></span>",n.html(t)}};var i={_domCache:function(){e.setObjVariable(i,".cb-cropwrap","cb-"),i.$imgpos=i.$cropwrap.find(".imgpos"),t=e.stringToDate($("div[data-nowtime]").data("nowtime"))/1e3||(new Date).getTime()/1e3},tabContainerEvent:function(){$(".tabcontainer").each(function(){var t=$(this),n=$('div[tabcontainer="'+t.attr("id")+'"][tabname]');t.append(n)})},tabEvent:function(){var t=$("div[tabtarget]");t.css("display","block");var n=function(t){var n=t,e=n.attr("tabtarget"),a=$('div[tabname="'+e+'"]'),i=$("#"+a.attr("tabcontainer")),o=i.find('div[tabname="'+e+'"]');0===o.length&&i.append(a),i.find("div").hide(),a.show(),a.find("img,div").show()};t.each(function(){var t=$(this),e=t.attr("tabaction");"click"===e?t.on("click",function(){n($(this))}):"hover"===e&&t.on("mouseover",function(){n($(this))})})},couponEvent:function(){$('.cropwrap .imgpos[linktype="button"]').on("click",function(){var t=$(this).data("id");if(!t)return!1;var n={url:"/index.php?act=coupon&op=receiveCoupon",data:{coupon_ids:t,client:"pc"}};e.ajaxData(n,function(t){var n=t;"60004"===n.code?sbLib.loginShow(0):layer.alert(n.desc)})})},_bindEvents:function(){},_HotLinkComponent:function(){var o=[],r=[],c=[/goods_id=\d+/,/\d+.html/gi,/goods-\d+/],d={checkIconState:function(){i.$imgpos.each(function(t){var n=$(this),e=n.attr("href");if(e&&e.indexOf("item.shenba.com")>=0){for(var a=0;a<c.length;a++)c[a].test(e)&&(e=e.toString(),e=e.match(c[a]));null!=e&&(e=e.toString().match(/\d+/),void 0==n.attr("linkicon")&&null!=e&&o.push(e))}t===i.$imgpos.length-1&&d.showStateIcon()})},checkCountDownState:function(){var o=!1;i.$cropwrap.each(function(){var i=1e3*t,r=$(this),c=e.stringToDate(r.attr("showdate")+":00"),d=e.stringToDate(r.attr("hidedate")+":00");if(void 0===c&&void 0===d?o=!0:(void 0!=c&&void 0===d&&new Date(c)<i&&(o=!0),void 0!=d&&void 0===c&&i<new Date(d)&&(o=!0),void 0!=c&&void 0!=d&&(o=new Date(c)<i&&i<new Date(d))),o){r.find(n).show();var s=r.find(".imgpos[linktype='countdown']");s.each(function(){var t=new a($(this));t.start(),$(this).removeAttr("linktype")})}else r.hide(),r.find(n).hide()})},showStateIcon:function(){if(0===o.length)return!1;var t={url:"/index.php?act=index&op=getgoods_storage",data:{client:"pc",goods_id:o.toString()}};return e.ajaxData(t,function(t){var n=t;if(void 0!=n.data){var e=n.data;if(1===e.status&&void 0!=e.list){var a=e.list,i=0,o=0;for(i=0,o=a.length;o>i;i++)a[i].goods_storage<=0&&""!==a[i].goods_id&&r.push(a[i].goods_id);for(i=0,o=r.length;o>i;i++)$(".imgpos").each(function(){var t=$(this),n=t.attr("href"),e="";if(n)for(var a=0;a<c.length;a++)e=n.toString().match(/\d+/),e&&e[0]===r[i]&&t.children("b").css("display","block")})}}}),!1},init:function(){e.objectCallFunction(d,"checkIconState","checkCountDownState")}};d.init()},_ComponentsCustomEvent:function(){},_parseComponents:function(){e.objectCallFunction(i,"_domCache","_HotLinkComponent")},init:function(){var t=$("img"),n=t.length,e=0;t.one("load",function(){++e===n&&i._parseComponents()}).each(function(){this.complete&&$(this).load()})}};cbuilder={parse:function(t){t&&(cbuilder.selector=t),$(document).ready(function(){i.init()})}},cbuilder.parse()}();